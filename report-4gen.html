<!DOCTYPE html>
<html lang="ja">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="favicon-fue.ico">
  <link rel="apple-touch-icon" href="apple-touch-icon-fue.png">
  <link rel="icon" type="image/png" href="web-app-manifest-192x192-fue.png">
  <title>四元ピアス・報告用</title> <!-- Created by じぇ -->

  <style>

    body {
      margin: 20px;
      background-color: #2A2A2A;
      color: #eee;
      text-align: center;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .pierce-group {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin: 10px auto;
      max-width: 430px;
    }

    .pierce-category {
      border: 1px solid #ccc;
      padding: 5px;
    }

    .pierce-category h2 {
      font-size: 18px;
      margin: 3px 0;
    }

    .attribute {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: -3px 0;
    }

    .attribute span:first-child {
      margin-left: 5px;
      font-size: 18px;
    }

    .stars {
      font-size: 20px;
    }

    input[type="file"] {
      margin: 10px 0;
      font-size: 12px;
    }

    /* 大分類ごとの色指定 */
    .緋 { color: hotpink; }
    .憲 { color: red; }
    .濡 { color: gray; }
    .瑠 { color: royalblue; }

    /* 小分類ごとの色指定 */
    .斬 { color: lightgray; }
    .打 { color: lightgray; }
    .突 { color: lightgray; }
    .熱 { color: orangered; }
    .冷 { color: dodgerblue; }
    .雷 { color: yellow; }
    .陽 { color: darkorange; }
    .陰 { color: darkorchid; }

    /* 集計部分のスタイル */
    #summary {
      text-align: center;
      font-size: 16px;
    }

    /* 拡大縮小ボタンのスタイル */
    .zoom-buttons {
      position: fixed;
      top: 15px;
      right: 15px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 1000;
    }

    .zoom-buttons button {
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    /* リンクのスタイル */
    a:link {
      color: #1D9BF0;
      text-decoration: underline;
    }

    a:visited {
      color: #7755FF;
      text-decoration: underline;
    }

    a:hover {
      color: #0CFF57;
    }

    a:active {
      color: #FF0000;
      text-decoration: underline;
    }

    /* ハンバーガーメニューのスタイル */
    .hamburger {
      font-size: 24px;
      cursor: pointer;
      margin-left: -5px;
      margin-right: 6px;
      user-select: none;
      color: #eee;
      transition: color 0.3s;
      display: inline-block;
    }
    
    .hamburger:hover {
      color: #2A99E6;
    }

    .side-menu {
      position: fixed;
      top: 0;
      left: -300px;
      width: 300px;
      height: 100vh;
      background-color: #242424;
      border-right: 1px solid #555;
      transition: left 0.3s ease;
      z-index: 1000;
      padding: 20px;
      box-sizing: border-box;
    }

    .side-menu.open {
      left: 0;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .menu-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .menu-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #eee;
      user-select: none;
    }

    .menu-close:hover {
      color: #ff6b6b;
    }

    .menu-title {
      font-size: 18px;
      font-weight: bold;
      text-align: left;
      margin-bottom: 10px;
      color: #2A99E6;
    }

    .menu-item {
      font-size: 18px;
      text-align: left;
      display: block;
      padding: 12px 0;
      color: #eee;
      text-decoration: none;
      border-bottom: 1px solid #333;
      transition: color 0.3s;
    }

    .menu-item:hover {
      color: #2A99E6;
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .menu-spacer {
      height: 30px;
    }

  </style>

</head>
<body>

  <!-- サイドメニューオーバーレイ -->
  <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>

  <!-- サイドメニュー -->
  <div class="side-menu" id="sideMenu">
    <div class="menu-title">リンクメニュー</div>
    <a href="index.html" class="menu-item">インデックスページ</a>
    <div class="menu-spacer"></div>
    <a href="checker-4gen.html" class="menu-item">四元ピアスチェッカー</a>
    <a href="checker-stella.html" class="menu-item">ステライヤリングチェッカー</a>
    <a href="checker-niji.html" class="menu-item">虹瑠璃の腕輪チェッカー</a>
    <div class="menu-spacer"></div>
    <a href="report-4gen.html" class="menu-item">四元ピアス報告用</a>
    <a href="report-stella.html" class="menu-item">ステライヤリング報告用</a>
    <a href="report-niji.html" class="menu-item">虹瑠璃の腕輪報告用</a>
    <div class="menu-spacer"></div>
  </div>

  <!-- ハンバーガーメニューとヘッダー -->
  <div class="header">
    <h1><span class="hamburger" onclick="toggleMenu()">☰</span> 四元ピアス・報告用</h1>
  </div>

  <div class="zoom-buttons">
    <button onclick="changeZoom(0.1)">＋</button>
    <button onclick="changeZoom(-0.1)">－</button>
  </div>

  <input type="file" id="importJson" accept=".json">

  <div class="pierce-group" id="pierceGroup"></div>

  <div id="summary"></div>

  <br><a href="checker-4gen.html">チェッカーへ戻る</a><br>

  <script>

    // ハンバーガーメニューの関数
    function toggleMenu() {
      const sideMenu = document.getElementById('sideMenu');
      const menuOverlay = document.getElementById('menuOverlay');

      if (sideMenu.classList.contains('open')) {
        closeMenu();
      } else {
        sideMenu.classList.add('open');
        menuOverlay.classList.add('open');
      }
    }

    function closeMenu() {
      const sideMenu = document.getElementById('sideMenu');
      const menuOverlay = document.getElementById('menuOverlay');
      const menuClose = document.getElementById('menuClose');

      sideMenu.classList.remove('open');
      menuOverlay.classList.remove('open');
      menuClose.style.color = '#eee';
    }

    // フリックでメニュー開閉
    let startX = 0;
    let endX = 0;

    document.addEventListener('touchstart', function (e) {
      startX = e.changedTouches[0].screenX;
    }, false);

    document.addEventListener('touchend', function (e) {
      endX = e.changedTouches[0].screenX;
      handleGesture();
    }, false);

    function handleGesture() {
      let diffX = endX - startX;

      if (Math.abs(diffX) > 50) {  // 50px以上の動きで判定
        // かつ開始位置が30px以内なら右フリックと判定
        if (diffX > 0 && startX < 30) {
          // 右にフリック
          toggleMenu();
        } else {
          // 左にフリック
          closeMenu();
        }
      }
    }

    const pierces = [
      { name: "緋のピアス", className: "緋" },
      { name: "濡羽のピアス", className: "濡" },
      { name: "憲法のピアス", className: "憲" },
      { name: "瑠璃紺のピアス", className: "瑠" }
    ];

    const attributes = ["斬", "打", "突", "熱", "冷", "雷", "陽", "陰"];
    const pierceGroup = document.getElementById("pierceGroup");

    // 星を色付きで装飾する関数
    function decorateStars(text) {
      let result = "";
      for (let char of text) {
        if (char === "★") {
          result += `<span style="color: gold; font-size: inherit;">★</span>`;
        } else if (char === "☆") {
          result += `<span style="color: gray; font-size: inherit;">☆</span>`;
        } else {
          result += char;
        }
      }
      return result;
    }

    // 初期表示生成
    pierces.forEach(p => {
      const category = document.createElement("div");
      category.className = "pierce-category";
      category.innerHTML = `<h2 class="${p.className}">◆${p.name}</h2>`;
      attributes.forEach(attr => {
        const div = document.createElement("div");
        div.className = "attribute";
        const id = `◆${p.name}_${attr}`;
        div.innerHTML = `<span class="${attr}">${attr}</span> <span class="stars" id="${id}">${decorateStars("☆☆☆☆☆")}</span>`;
        category.appendChild(div);
      });
      pierceGroup.appendChild(category);
    });

    // ★数を集計して表示する関数
    function updateSummary() {
      let total = 0;
      let categoryTotals = { "緋": 0, "憲": 0, "濡": 0, "瑠": 0 };

      pierces.forEach(p => {
        attributes.forEach(attr => {
          const el = document.getElementById(`◆${p.name}_${attr}`);
          if (el) {
            const starCount = (el.textContent.match(/★/g) || []).length;
            categoryTotals[p.className] += starCount;
            total += starCount;
          }
        });
      });

      // 表示文字列作成
      const summaryHTML = `
      <div>
        <span class="緋">緋</span> ${categoryTotals["緋"]}/40　
        <span class="憲">憲</span> ${categoryTotals["憲"]}/40　
        <span class="濡">濡</span> ${categoryTotals["濡"]}/40　
        <span class="瑠">瑠</span> ${categoryTotals["瑠"]}/40
      </div>
      <div style="margin-top: 4px;">
        全 ${total}/160
      </div>
    `;

      document.getElementById("summary").innerHTML = summaryHTML;
    }

    // JSON読込
    document.getElementById("importJson").addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const data = JSON.parse(e.target.result);
        for (let key in data) {
          const el = document.getElementById(key);
          if (el) {
            el.innerHTML = decorateStars(data[key]);
          }
        }
        updateSummary(); // 読込後に集計実行
      };
      reader.readAsText(file);
    });

    // 初期表示の時点でも集計実行
    updateSummary();

    let zoomLevel = 1;

    // 拡大縮小の関数
    function changeZoom(delta) {
      zoomLevel += delta;
      if (zoomLevel < 0.5) zoomLevel = 0.5;  // 最小倍率0.5倍
      if (zoomLevel > 2.0) zoomLevel = 2.0;  // 最大倍率2倍
      document.body.style.zoom = zoomLevel;
    }

  </script>

</body>
</html>