<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>装備候補検索ツール</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const ArmorCombinationAnalyzer = () => {
          const [mainArmor, setMainArmor] = useState([]);
          const [subArmor, setSubArmor] = useState([]);
          const [decorations, setDecorations] = useState([]);
          const [characterResistances, setCharacterResistances] = useState([]);
          const [combinations, setCombinations] = useState({});
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState('');
          const [searching, setSearching] = useState({});
          const [activeTab, setActiveTab] = useState('キャラ１');
          const dropdownRefs = useRef({});
          
          // データファイルのパス設定
          const dataFiles = {
            mainArmor: './data/armor-main.csv',
            subArmor: './data/armor-sub.csv',
            decorations: './data/decoration.csv',
            characterResistances: './data/favorite.csv'
          };
          
          // キャラクター名リスト
          const characterNames = ['キャラ１', 'キャラ２', 'キャラ３', 'キャラ４', 'キャラ５'];
          
          // 目標値設定
          const [targetValues, setTargetValues] = useState({
            斬: 35,
            打: 35,
            突: 35,
            熱: 35,
            冷: 35,
            雷: 35,
            陽: 35,
            陰: 35
          });

          // 各キャラのキャラ耐性値設定
          const [characterValues, setCharacterValues] = useState({
            'キャラ１': { 斬: 0, 打: 0, 突: 0, 熱: 0, 冷: 0, 雷: 0, 陽: 0, 陰: 0 },
            'キャラ２': { 斬: 0, 打: 0, 突: 0, 熱: 0, 冷: 0, 雷: 0, 陽: 0, 陰: 0 },
            'キャラ３': { 斬: 0, 打: 0, 突: 0, 熱: 0, 冷: 0, 雷: 0, 陽: 0, 陰: 0 },
            'キャラ４': { 斬: 0, 打: 0, 突: 0, 熱: 0, 冷: 0, 雷: 0, 陽: 0, 陰: 0 },
            'キャラ５': { 斬: 0, 打: 0, 突: 0, 熱: 0, 冷: 0, 雷: 0, 陽: 0, 陰: 0 }
          });

          // 各キャラの選択されたキャラクター
          const [selectedCharacters, setSelectedCharacters] = useState({
            'キャラ１': '',
            'キャラ２': '',
            'キャラ３': '',
            'キャラ４': '',
            'キャラ５': ''
          });

          // 状態異常耐性設定（複数選択対応）
          
          const [fixedEquipments, setFixedEquipments] = useState({
            'キャラ１': { main: '', sub: '', deco: '' },
            'キャラ２': { main: '', sub: '', deco: '' },
            'キャラ３': { main: '', sub: '', deco: '' },
            'キャラ４': { main: '', sub: '', deco: '' },
            'キャラ５': { main: '', sub: '', deco: '' }
          });

          const [statusAilmentSettings, setStatusAilmentSettings] = useState({
            'キャラ１': { 
              selectedTypes: [], 
              value: 20,
              showDropdown: false
            },
            'キャラ２': { 
              selectedTypes: [], 
              value: 20,
              showDropdown: false
            },
            'キャラ３': { 
              selectedTypes: [], 
              value: 20,
              showDropdown: false
            },
            'キャラ４': { 
              selectedTypes: [], 
              value: 20,
              showDropdown: false
            },
            'キャラ５': { 
              selectedTypes: [], 
              value: 20,
              showDropdown: false
            }
          });

          // 状態異常の種類
          const statusAilmentTypes = ['毒', '暗闇', 'スタン', 'マヒ', '眠り', '石化', '混乱', '魅了', '狂戦士', '気絶'];

          useEffect(() => {
            loadData();
          }, []);

          // 外部クリックでドロップダウンを閉じる
          useEffect(() => {
            const handleClickOutside = (event) => {
              // アクティブなタブのドロップダウンのみをチェック
              if (statusAilmentSettings[activeTab].showDropdown &&
                  dropdownRefs.current[activeTab] && 
                  !dropdownRefs.current[activeTab].contains(event.target)) {
                setStatusAilmentSettings(prev => ({
                  ...prev,
                  [activeTab]: {
                    ...prev[activeTab],
                    showDropdown: false
                  }
                }));
              }
            };
          
            document.addEventListener('mousedown', handleClickOutside);
            return () => {
              document.removeEventListener('mousedown', handleClickOutside);
            };
          }, [activeTab, statusAilmentSettings]);

          const loadCSVFile = async (url) => {
            try {
              const response = await fetch(url);
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              const text = await response.text();
              const parsed = Papa.parse(text, { 
                header: true, 
                skipEmptyLines: true,
                dynamicTyping: true,
                transformHeader: (header) => header.trim()
              });
              
              if (parsed.errors.length > 0) {
                console.warn(`CSV parsing warnings for ${url}:`, parsed.errors);
              }
              
              return parsed.data;
            } catch (error) {
              throw new Error(`Failed to load ${url}: ${error.message}`);
            }
          };

          const loadCharacterResistances = async () => {
            try {
              const response = await fetch(dataFiles.characterResistances);
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              const text = await response.text();
              const parsed = Papa.parse(text, { 
                header: true, 
                skipEmptyLines: true,
                dynamicTyping: true,
                transformHeader: (header) => header.trim()
              });
              
              if (parsed.errors.length > 0) {
                console.warn(`CSV parsing warnings for character resistances:`, parsed.errors);
              }
              
              return parsed.data;
            } catch (error) {
              throw new Error(`Failed to load character resistances: ${error.message}`);
            }
          };

          const loadData = async () => {
            setLoading(true);
            setError('');
            try {
              // 全てのデータを並列で読み込み
              const [mainArmorData, subArmorData, decorationData, characterData] = await Promise.all([
                loadCSVFile(dataFiles.mainArmor),
                loadCSVFile(dataFiles.subArmor),
                loadCSVFile(dataFiles.decorations),
                loadCharacterResistances()
              ]);
              
              setMainArmor(mainArmorData);
              setSubArmor(subArmorData);
              setDecorations(decorationData);
              setCharacterResistances(characterData);
              
              console.log('データ読み込み完了:', {
                mainArmor: mainArmorData.length,
                subArmor: subArmorData.length,
                decorations: decorationData.length,
                characters: characterData.length
              });
              
            } catch (error) {
              setError(`データの読み込みエラー: ${error.message}`);
              console.error('Load error:', error);
            } finally {
              setLoading(false);
            }
          };

          const calculateCombinations = (characterName) => {
            if (mainArmor.length === 0 || subArmor.length === 0 || decorations.length === 0) {
              return;
            }

            setSearching(prev => ({ ...prev, [characterName]: true }));
            
            // 少し遅延を入れて検索中の表示を見えるようにする
            
            const fixed = fixedEquipments[characterName];
            const mainList = fixed.main ? mainArmor.filter(a => a['名称'] === fixed.main) : mainArmor;
            const subList = fixed.sub ? subArmor.filter(a => a['名称'] === fixed.sub) : subArmor;
            const decoList = fixed.deco ? decorations.filter(a => a['名称'] === fixed.deco) : decorations;

            setTimeout(() => {
              const results = [];
              const attributes = ['斬', '打', '突', '熱', '冷', '雷', '陽', '陰'];
              const currentCharValues = characterValues[characterName];
              const statusAilmentSetting = statusAilmentSettings[characterName];
              
              // 全ての組み合わせを計算
            mainList.forEach(main => {
              subList.forEach(sub => {
                decoList.forEach(decoration => {
                    const totals = {};
                    let meetsConditions = true;
                    
                    // 各属性の合計値を計算
                    attributes.forEach(attr => {
                      const mainValue = parseInt(main[attr] || 0);
                      const subValue = parseInt(sub[attr] || 0);
                      const decorationValue = parseInt(decoration[attr] || 0);
                      
                      totals[attr] = mainValue + subValue + decorationValue + currentCharValues[attr];
                      
                      // 条件チェック（目標値に達しているか）
                      if (totals[attr] < targetValues[attr]) {
                        meetsConditions = false;
                      }
                    });

                    // 状態異常耐性のチェック（複数選択対応）
                    if (statusAilmentSetting.selectedTypes.length > 0 && statusAilmentSetting.value > 0) {
                      statusAilmentSetting.selectedTypes.forEach(ailmentType => {
                        const statusAilmentTotal = 
                          (parseInt(main[ailmentType] || 0)) +
                          (parseInt(sub[ailmentType] || 0)) +
                          (parseInt(decoration[ailmentType] || 0));
                        
                        if (statusAilmentTotal < statusAilmentSetting.value) {
                          meetsConditions = false;
                        }
                        
                        totals[ailmentType] = statusAilmentTotal;
                      });
                    }
                    
                    if (meetsConditions) {
                      results.push({
                        mainArmor: main['名称'] || main[Object.keys(main)[0]],
                        subArmor: sub['名称'] || sub[Object.keys(sub)[0]],
                        decoration: decoration['名称'] || decoration[Object.keys(decoration)[0]],
                        totals
                      });
                    }
                  });
                });
              });

              setCombinations(prev => ({ ...prev, [characterName]: results }));
              setSearching(prev => ({ ...prev, [characterName]: false }));
            }, 100);
          };

          const handleTargetValueChange = (attr, value) => {
            setTargetValues(prev => ({
              ...prev,
              [attr]: parseInt(value) || 0
            }));
          };

          const handleCharacterValueChange = (characterName, attr, value) => {
            setCharacterValues(prev => ({
              ...prev,
              [characterName]: {
                ...prev[characterName],
                [attr]: parseInt(value) || 0
              }
            }));
          };

          const handleCharacterSelect = (characterName, selectedName) => {
            setSelectedCharacters(prev => ({
              ...prev,
              [characterName]: selectedName
            }));
            
            if (selectedName === '') {
              // キャラクターが選択されていない場合はすべて0にリセット
              setCharacterValues(prev => ({
                ...prev,
                [characterName]: {
                  斬: 0, 打: 0, 突: 0, 熱: 0, 冷: 0, 雷: 0, 陽: 0, 陰: 0
                }
              }));
              return;
            }

            const character = characterResistances.find(char => char['登録名'] === selectedName);
            if (character) {
              const attributes = ['斬', '打', '突', '熱', '冷', '雷', '陽', '陰'];
              const newValues = {};
              
              attributes.forEach(attr => {
                newValues[attr] = parseInt(character[attr] || 0);
              });
              
              setCharacterValues(prev => ({
                ...prev,
                [characterName]: newValues
              }));
            }
          };

          const resetTargetValues = () => {

            const confirmed = window.confirm("リセットしてよろしいですか？");
            if (!confirmed) return;
          
            setTargetValues({
              斬: 0, 打: 0, 突: 0, 熱: 0, 冷: 0, 雷: 0, 陽: 0, 陰: 0
            });
          };

          const resetCharacterValues = (characterName) => {
          
            const confirmed = window.confirm("リセットしてよろしいですか？");
            if (!confirmed) return;
          
            setCharacterValues(prev => ({
              ...prev,
              [characterName]: {
                斬: 0, 打: 0, 突: 0, 熱: 0, 冷: 0, 雷: 0, 陽: 0, 陰: 0
              }
            }));
          
            setSelectedCharacters(prev => ({
              ...prev,
              [characterName]: ''
            }));
          
            setStatusAilmentSettings(prev => ({
              ...prev,
              [characterName]: { 
                selectedTypes: [], 
                value: 0,
                showDropdown: false
              }
            }));
          
            setFixedEquipments(prev => ({
              ...prev,
              [characterName]: { main: '', sub: '', deco: '' }
            }));
          
          };

          const handleStatusAilmentValueChange = (characterName, value) => {
            setStatusAilmentSettings(prev => ({
              ...prev,
              [characterName]: {
                ...prev[characterName],
                value: parseInt(value) || 0
              }
            }));
          };

          const toggleStatusAilmentDropdown = (characterName) => {
            setStatusAilmentSettings(prev => ({
              ...prev,
              [characterName]: {
                ...prev[characterName],
                showDropdown: !prev[characterName].showDropdown
              }
            }));
          };

          const handleStatusAilmentTypeChange = (characterName, type, checked) => {
            setStatusAilmentSettings(prev => {
              const currentSelected = prev[characterName].selectedTypes;
              let newSelected;
              
              if (checked) {
                newSelected = [...currentSelected, type];
              } else {
                newSelected = currentSelected.filter(t => t !== type);
              }
              
              return {
                ...prev,
                [characterName]: {
                  ...prev[characterName],
                  selectedTypes: newSelected
                }
              };
            });
          };

          const handleSelectAllStatusAilments = (characterName, checked) => {
            setStatusAilmentSettings(prev => ({
              ...prev,
              [characterName]: {
                ...prev[characterName],
                selectedTypes: checked ? [...statusAilmentTypes] : []
              }
            }));
          };

          const isAllStatusAilmentsSelected = (characterName) => {
            const selected = statusAilmentSettings[characterName].selectedTypes;
            return statusAilmentTypes.every(type => selected.includes(type));
          };

          const getStatusAilmentDisplayText = (characterName) => {
            const selected = statusAilmentSettings[characterName].selectedTypes;
            if (selected.length === 0) return "(未指定)";
            if (selected.length === statusAilmentTypes.length) return "すべて選択";
            if (selected.length === 1) return selected[0];
            return `${selected.length}個選択`;
          };

          const attributes = ['斬', '打', '突', '熱', '冷', '雷', '陽', '陰'];

          return (
            <div className="max-w-7xl mx-auto p-6">
              <div className="bg-white rounded-lg shadow-lg p-6">
                <h1 className="text-2xl font-bold mb-6 text-gray-800">装備候補検索ツール ver.2025/07/08　</h1>※使用は自己責任にて。
                
                {/* 読み込み状態の表示 */}
                {loading && (
                  <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                    <div className="flex items-center">
                      <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                      <span className="text-blue-600">データを読み込み中...</span>
                    </div>
                  </div>
                )}
                
                {/* エラー表示 */}
                {error && (
                  <div className="mb-6 p-4 bg-red-50 rounded-lg">
                    <div className="text-red-600 mb-2">{error}</div>
                    <div className="text-sm text-red-500 mb-3">
                      以下のファイルが必要です：
                      <ul className="list-disc list-inside mt-1 ml-4">
                        <li>./data/armor-main.csv（主防具データ）</li>
                        <li>./data/armor-sub.csv（副防具データ）</li>
                        <li>./data/decoration.csv（装飾品データ）</li>
                        <li>./data/favorite.csv（キャラ耐性データ）</li>
                      </ul>
                    </div>
                    <button
                      onClick={loadData}
                      className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded transition-colors"
                    >
                      再試行
                    </button>
                  </div>
                )}

                {/* 目標値設定 */}
                {!loading && !error && (
                  <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-lg font-semibold text-blue-800">目標値設定</h2>
                      <button
                        onClick={resetTargetValues}
                        className="text-sm bg-blue-200 hover:bg-blue-300 px-4 py-2 rounded transition-colors"
                      >
                        リセット
                      </button>
                    </div>
                    
                    <div className="grid grid-cols-2 md:grid-cols-8 gap-4">
                      {attributes.map(attr => (
                        <div key={attr} className="flex items-center gap-2">
                          <label className="font-medium w-8 text-blue-700">{attr}:</label>
                          <input
                            type="number"
                            value={targetValues[attr]}
                            onChange={(e) => handleTargetValueChange(attr, e.target.value)}
                            className="border border-blue-300 rounded px-3 py-2 w-20 text-center"
                          />
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* キャラクタータブ */}
                {!loading && !error && (
                  <div className="mb-6">
                    <div className="flex border-b border-gray-200 mb-4">
                      {characterNames.map(charName => (
                        <button
                          key={charName}
                          onClick={() => setActiveTab(charName)}
                          className={`px-4 py-2 font-medium transition-colors ${
                            activeTab === charName
                              ? 'border-b-2 border-green-500 text-green-600'
                              : 'text-gray-500 hover:text-gray-700'
                          }`}
                        >
                          {charName}
                        </button>
                      ))}
                    </div>

                    {/* アクティブなキャラクターの設定 */}
                    <div className="p-4 bg-green-50 rounded-lg">
                      <div className="flex items-center justify-between mb-4">
                        <h2 className="text-lg font-semibold text-green-800">{activeTab} 耐性値設定</h2>
                        <button
                          onClick={() => resetCharacterValues(activeTab)}
                          className="text-sm bg-green-200 hover:bg-green-300 px-4 py-2 rounded transition-colors"
                        >
                          リセット
                        </button>
                      </div>
                      
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">

                        <div className="flex items-center gap-2">
                          <label className="min-w-[120px] text-sm text-green-700">キャラクター選択:</label>
                        <select
                          value={selectedCharacters[activeTab]}
                          onChange={(e) => handleCharacterSelect(activeTab, e.target.value)}
                          className={`w-full border rounded px-3 py-2 ${
                            selectedCharacters[activeTab] === '' ? 'border-gray-300 bg-gray-200' : 'border-green-300 bg-white'
                          }`}
                        >
                          <option value="">(未指定)</option>
                          {characterResistances.map((char, index) => (
                            <option key={index} value={char['登録名']}>
                              {char['登録名']}
                            </option>
                          ))}
                        </select>
                    </div>
                        
                    {/* 状態異常耐性のドロップダウン */}
                    <div className="flex items-center gap-2">
                      <label className="min-w-[90px] text-sm text-green-700">状態異常耐性:</label>
                      <div className="relative w-full" ref={el => dropdownRefs.current[activeTab] = el}>
                        <button
                          onClick={() => toggleStatusAilmentDropdown(activeTab)}
                          className={`border rounded px-3 py-2 flex items-center gap-2 w-full justify-between ${
                            statusAilmentSettings[activeTab].selectedTypes.length === 0 ? 'border-gray-300 bg-gray-200' : 'border-green-300 bg-white'
                          }`}
                        >
                          <span>{getStatusAilmentDisplayText(activeTab)}</span>
                          <span className="text-gray-500">▼</span>
                        </button>
                        
                        {statusAilmentSettings[activeTab].showDropdown && (
                          <div className="absolute top-full left-0 mt-1 bg-white border border-green-300 rounded shadow-lg z-10 w-full">
                            {/* すべて選択 */}
                            <div className="p-2 border-b border-gray-200">
                              <label className="flex items-center gap-2 cursor-pointer">
                                <input
                                  type="checkbox"
                                  checked={isAllStatusAilmentsSelected(activeTab)}
                                  onChange={(e) => handleSelectAllStatusAilments(activeTab, e.target.checked)}
                                  className="rounded"
                                />
                                <span className="font-medium text-green-700">すべて選択</span>
                              </label>
                            </div>
                            
                            {/* 個別選択 */}
                            <div className="max-h-100 overflow-y-auto">
                              {statusAilmentTypes.map(type => (
                                <div key={type} className="p-2 hover:bg-gray-50">
                                  <label className="flex items-center gap-2 cursor-pointer">
                                    <input
                                      type="checkbox"
                                      checked={statusAilmentSettings[activeTab].selectedTypes.includes(type)}
                                      onChange={(e) => handleStatusAilmentTypeChange(activeTab, type, e.target.checked)}
                                      className="rounded"
                                    />
                                    <span>{type}</span>
                                  </label>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                   
                        <div className="flex items-center gap-2">
                          <label className="min-w-[50px] text-sm text-green-700">耐性値:</label>
                          <input
                            type="number"
                            value={statusAilmentSettings[activeTab].value}
                            onChange={(e) => handleStatusAilmentValueChange(activeTab, e.target.value)}
                            className={`border rounded px-3 py-2 w-20 text-center ${
                              statusAilmentSettings[activeTab].selectedTypes.length === 0 ? 'border-gray-300 bg-gray-200' : 'border-green-300 bg-white'
                            }`}
                            min="0"
                          />
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                          <label className="text-sm text-gray-600">主防具 指定</label>
                          <select
                            value={fixedEquipments[activeTab].main}
                            onChange={(e) =>
                              setFixedEquipments((prev) => ({
                                ...prev,
                                [activeTab]: { ...prev[activeTab], main: e.target.value }
                              }))
                            }
                            className={`w-full border rounded px-3 py-2 ${
                              fixedEquipments[activeTab].main === '' ? 'border-gray-300 bg-gray-200' : 'border-green-300 bg-white'
                            }`}
                          >
                            <option value="">（未指定）</option>
                            {mainArmor.map((item, idx) => (
                              <option key={idx} value={item['名称']}>{item['名称']}</option>
                            ))}
                          </select>
                        </div>
                        <div>
                          <label className="text-sm text-gray-600">副防具 指定</label>
                          <select
                            value={fixedEquipments[activeTab].sub}
                            onChange={(e) =>
                              setFixedEquipments((prev) => ({
                                ...prev,
                                [activeTab]: { ...prev[activeTab], sub: e.target.value }
                              }))
                            }
                            className={`w-full border rounded px-3 py-2 ${
                              fixedEquipments[activeTab].sub === '' ? 'border-gray-300 bg-gray-200' : 'border-green-300 bg-white'
                            }`}
                          >
                            <option value="">（未指定）</option>
                            {subArmor.map((item, idx) => (
                              <option key={idx} value={item['名称']}>{item['名称']}</option>
                            ))}
                          </select>
                        </div>
                        <div>
                          <label className="text-sm text-gray-600">装飾品 指定</label>
                          <select
                            value={fixedEquipments[activeTab].deco}
                            onChange={(e) =>
                              setFixedEquipments((prev) => ({
                                ...prev,
                                [activeTab]: { ...prev[activeTab], deco: e.target.value }
                              }))
                            }
                            className={`w-full border rounded px-3 py-2 ${
                              fixedEquipments[activeTab].deco === '' ? 'border-gray-300 bg-gray-200' : ' border-green-300 bg-white'
                            }`}
                          >
                            <option value="">（未指定）</option>
                            {decorations.map((item, idx) => (
                              <option key={idx} value={item['名称']}>{item['名称']}</option>
                            ))}
                          </select>
                        </div>
                      </div>

                      <div className="grid grid-cols-2 md:grid-cols-8 gap-4 mb-4">
                        {attributes.map(attr => (
                          <div key={attr} className="flex items-center gap-2">
                            <label className="font-medium w-8 text-green-700">{attr}:</label>
                            <input
                              type="number"
                              value={characterValues[activeTab][attr]}
                              onChange={(e) => handleCharacterValueChange(activeTab, attr, e.target.value)}
                              className="border border-green-300 rounded px-3 py-2 w-20 text-center"
                            />
                          </div>
                        ))}
                      </div>

                      {/* 検索ボタン */}
                      <div className="text-center">
                        <button
                          onClick={() => calculateCombinations(activeTab)}
                          disabled={searching[activeTab]}
                          className={`px-8 py-3 rounded-lg font-semibold transition-colors ${
                            searching[activeTab]
                              ? 'bg-gray-400 text-gray-600 cursor-not-allowed'
                              : 'bg-green-600 hover:bg-green-700 text-white'
                          }`}
                        >
                          {searching[activeTab] ? (
                            <div className="flex items-center">
                              <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                              {activeTab} 検索中...
                            </div>
                          ) : (
                            `${activeTab} 装備候補を検索`
                          )}
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* 統計情報 */}
                {mainArmor.length > 0 && (
                  <div className="mb-6 grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-blue-50 p-3 rounded-lg">
                      <div className="text-sm text-blue-600">主防具 登録数</div>
                      <div className="text-xl font-bold text-blue-800">{mainArmor.length}</div>
                    </div>
                    <div className="bg-green-50 p-3 rounded-lg">
                      <div className="text-sm text-green-600">副防具 登録数</div>
                      <div className="text-xl font-bold text-green-800">{subArmor.length}</div>
                    </div>
                    <div className="bg-purple-50 p-3 rounded-lg">
                      <div className="text-sm text-purple-600">装飾品 登録数</div>
                      <div className="text-xl font-bold text-purple-800">{decorations.length}</div>
                    </div>
                    <div className="bg-red-50 p-3 rounded-lg">
                      <div className="text-sm text-red-600">{activeTab} 適合組み合わせ</div>
                      <div className="text-xl font-bold text-red-800">{combinations[activeTab]?.length || 0}</div>
                    </div>
                  </div>
                )}

                {/* 結果表示 */}
                {combinations[activeTab] && combinations[activeTab].length > 0 && (
                  <div className="overflow-x-auto">
                    <h2 className="text-lg font-semibold mb-4">
                      {activeTab} - 条件を満たす組み合わせ ({combinations[activeTab].length}件)
                    </h2>
                    
                    <table className="min-w-full bg-white border border-gray-200">
                      <thead className="bg-gray-50">
                        <tr>
                          <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">主防具</th>
                          <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">副防具</th>
                          <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">装飾品</th>
                          {attributes.map(attr => (
                            <th key={attr} className="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">
                              {attr}
                            </th>
                          ))}
                          {statusAilmentSettings[activeTab].type && statusAilmentSettings[activeTab].type !== 'all' && (
                            <th className="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">
                              {statusAilmentSettings[activeTab].type}
                            </th>
                          )}
                          {statusAilmentSettings[activeTab].type === 'all' && statusAilmentTypes.map(type => (
                            <th key={type} className="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">
                              {type}
                            </th>
                          ))}
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-gray-200">
                        {combinations[activeTab].slice(0, 100).map((combo, index) => (
                          <tr key={index} className="hover:bg-gray-50">
                            <td className="px-4 py-2 text-sm text-gray-900">{combo.mainArmor}</td>
                            <td className="px-4 py-2 text-sm text-gray-900">{combo.subArmor}</td>
                            <td className="px-4 py-2 text-sm text-gray-900">{combo.decoration}</td>
                            {attributes.map(attr => (
                              <td key={attr} className={`px-4 py-2 text-sm text-center ${
                                combo.totals[attr] >= targetValues[attr] ? 'text-green-600 font-medium' : 'text-gray-500'
                              }`}>
                                {combo.totals[attr]}
                              </td>
                            ))}
                            {statusAilmentSettings[activeTab].type && statusAilmentSettings[activeTab].type !== 'all' && (
                              <td className={`px-4 py-2 text-sm text-center ${
                                combo.totals[statusAilmentSettings[activeTab].type] >= statusAilmentSettings[activeTab].value ? 'text-green-600 font-medium' : 'text-gray-500'
                              }`}>
                                {combo.totals[statusAilmentSettings[activeTab].type] || 0}
                              </td>
                            )}
                            {statusAilmentSettings[activeTab].type === 'all' && statusAilmentTypes.map(type => (
                              <td key={type} className={`px-4 py-2 text-sm text-center ${
                                combo.totals[type] >= statusAilmentSettings[activeTab].value ? 'text-green-600 font-medium' : 'text-gray-500'
                              }`}>
                                {combo.totals[type] || 0}
                              </td>
                            ))}
                          </tr>
                        ))}
                      </tbody>
                    </table>
                    
                    {combinations[activeTab].length > 100 && (
                      <div className="mt-4 text-sm text-gray-600 text-center">
                        上位100件を表示しています。全{combinations[activeTab].length}件の組み合わせがあります。
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<ArmorCombinationAnalyzer />, document.getElementById('root'));
    </script>
</body>
</html>