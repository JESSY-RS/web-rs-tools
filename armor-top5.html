<!DOCTYPE html>
<html lang="ja">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon-renma.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon-renma.png">
    <link rel="icon" type="image/png" href="web-app-manifest-192x192-renma.png">
    <title>ç·´ç£¨(é˜²å…·)ã‚¢ãƒ“ãƒªãƒ†ã‚£ TOP5</title> 
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image-more/2.10.1/dom-to-image-more.min.js"></script>

    <style>
        /* --- å…¨ä½“ --- */
        body {
            background-color: #2A2A2A;
            color: #eee;
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
        header {
            text-align: center;
        }

        h1 {
            color: #50b4f0;
            margin-top: 0px;
            margin-bottom: -5px;
        }

        /* --- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ --- */
        .controls-container {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
        }

        .checkbox-container {
            margin-bottom: 15px;
            font-size: 16px;
        }
        .checkbox-container label {
            cursor: pointer;
        }

        /* --- çµæœã‚°ãƒªãƒƒãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ (ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ) --- */
        .results-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* ã‚³ãƒ³ãƒ†ãƒŠé–“ã®éš™é–“ */
            justify-content: center;
            max-width: 1400px; /* ãƒšãƒ¼ã‚¸ã®æœ€å¤§å¹…ã‚’ã‚ˆã‚Šã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«è¨­å®š */
            width: 100%;
            margin: 0 auto; /* ä¸­å¤®é…ç½®ã‚’å¼·åŒ– */
        }

        .category-container {
            background-color: #383838;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 20px;
            box-sizing: border-box;
            justify-content: center;
            flex-basis: 100%; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1åˆ— */
        }

        /* PCãªã©åºƒã„ç”»é¢(1200pxä»¥ä¸Š)ã§ã¯2x2ã‚°ãƒªãƒƒãƒ‰ã« */
        @media (min-width: 1200px) {
            .category-container {
                flex-basis: 45%; /* 50%ã‚ˆã‚Šå°‘ã—å°ã•ãã—ã¦gapã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ */
            }
        }

        h2 {
            color: #c0c0ff;
            margin-top: -5px;
            margin-bottom: 15px;
            border-bottom: 2px solid #555;
            padding-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ç§»å‹•ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .nav-buttons {
            display: flex;
            gap: 6px;
        }

        .nav-button {
            background-color: #555;
            color: #eee;
            border: 1px solid #777;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .nav-button:hover {
            background-color: #666;
        }

        .nav-button:active {
            background-color: #444;
        }

        .nav-button:disabled {
            background-color: #333;
            color: #666;
            cursor: default;
            opacity: 0.5;
        }

        /* --- ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« --- */
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* åˆ—å¹…ã‚’å›ºå®š */
        }

        th, td {
            padding: 10px;
            border: 1px solid #777; /* ç½«ç·šã®å¤ªã•ã‚’çµ±ä¸€ */
            text-align: left;
            word-wrap: break-word; /* é•·ã„å˜èªã‚’æŠ˜ã‚Šè¿”ã™ */
        }

        thead th {
            background-color: #444;
            color: #fff;
        }
        
        td.merged-ability-cell {
            vertical-align: top;
            color: #98fb98;
            border-bottom: none; 
        }

        .ability-total-cell {
            font-size: inherit;
            font-weight: bold;
            color: #f0e68c;
            vertical-align: bottom;
            border-top: none;
            text-align: right; /* â˜…å¤‰æ›´ç‚¹: ãƒ†ã‚­ã‚¹ãƒˆã‚’å³æƒãˆã« */
        }

        /* åˆ—å¹…ã®æŒ‡å®š */
        .col-ability { width: 37%; }
        .col-armor { width: 45%; }
        .col-value { width: 18%; }

        /* ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ã®åŠ¹æœå€¤ã¯å³æƒãˆ */
        td.value-col {
            text-align: right;
            font-weight: bold;
            color: #ffd700;
        }

        /* --- è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .combined-value {
            color: red !important;
        }
        .combined-armor-name {
            color: orange;
        }
        .special-armor-name {
            color: magenta;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®åŠ¹æœå€¤ã¯å·¦æƒãˆ */
        th.value-col {
            text-align: left;
        }

        .bottom {
            margin-top: 20px;
            font-size: 16pt;
            line-height: 2;
            text-align: center;
        }

        /* ãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        a:link {
            color: #1D9BF0;
            text-decoration: underline;
        }

        a:visited {
            color: #7755FF;
            text-decoration: underline;
        }

        a:hover {
            color: #0CFF57;
        }

        a:active {
            color: #FF0000;
            text-decoration: underline;
        }

        /* æ‹¡å¤§ç¸®å°ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« - absolute positioned to not scroll */
        .zoom-buttons {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 1000;
        }

        .zoom-buttons button {
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
        }

    /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .hamburger {
      cursor: pointer;
      margin-left: -5px;
      margin-right: 10px;
      user-select: none;
      color: #eee;
      display: inline-block;
    }
    
    .hamburger:hover {
      color: #2A99E6;
    }

    .side-menu {
      position: fixed;
      top: 0;
      left: -320px;
      width: 320px;
      min-height: 100vh;
      height: 100%;
      text-align: left;
      background-color: #242424;
      border-right: 1px solid #555;
      transition: left 0.3s ease;
      z-index: 1001;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .side-menu.open {
      left: 0;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      min-width: 100vw;
      min-height: 100vh;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .menu-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .menu-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #eee;
      user-select: none;
    }

    .menu-close:hover {
      color: #ff6b6b;
    }

    .menu-title {
      font-size: 18px;
      font-weight: bold;
      text-align: left;
      margin-bottom: 10px;
      color: #FF6E3D;
    }

    .menu-item {
      font-size: 18px;
      text-align: left;
      display: inline-block;
      padding: 6px 0;
      color: #eee;
      text-decoration: none;
    }

    .menu-item:hover {
      color: #0CFF57;
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .menu-spacer {
      height: 30px;
    }

   .toggle-button {
      cursor: pointer;
      color: #7755FF;
      text-decoration: underline;
      font-size: 18px;
      text-align: left;
      display: block;
      padding: 6px 0;
      user-select: none;
    }

    .toggle-button:hover {
      color: #0CFF57;
      text-decoration: underline;
    }

    #linkList {
      display: none;
      color: #7755FF;
    }

    #linkList1 {
      font-size: 18px;
      text-align: left;
      padding-bottom: 6px;
      display: none;
      color: #7755FF;
    }

    #linkList2 {
      font-size: 18px;
      text-align: left;
      display: none;
      color: #7755FF;
    }

    #linkList a {
      display: inline-block;
      text-decoration: none;
      color: #7755FF;
    }

    #linkList a:visited {
      color: #7755FF;
      text-decoration: underline;
    }

    #linkList a:hover {
      text-decoration: underline;
      color: #0CFF57;
    }

    #linkList a:active {
      color: #FF0000;
      text-decoration: underline;
    }

    </style>
</head>
<body>

  <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>

  <div class="side-menu" id="sideMenu">
    <div class="menu-title">ãƒªãƒ¦ãƒ‹ã®Webç‰ˆã„ã‚ã„ã‚</div>
    <a class="menu-item" href="kiokucalc.html">è¨˜æ†¶å†æˆ¦æ™‚é–“è¨ˆç®—</a><br>
    <a class="menu-item" href="kiokucalc2.html">è¨˜æ†¶å†æˆ¦å›æ•°è¨ˆç®—</a><br>
    </br>
    <a class="menu-item" href="ikuseicalc.html">è‚²æˆåŠ¹ç‡æ¯”è¼ƒãƒ„ãƒ¼ãƒ«</a><br>
    <a class="menu-item" href="raidcalc.html">ãƒ¬ã‚¤ãƒ‰å‘¨å›åŠ¹ç‡æ¯”è¼ƒãƒ„ãƒ¼ãƒ«</a><br>
    </br>
    <a class="menu-item" href="renma-armor.html">ç·´ç£¨(é˜²å…·)çµ±åˆãƒ„ãƒ¼ãƒ«</a><br>
    <span class="toggle-button" data-target="linkList3">ç·´ç£¨(é˜²å…·)å€‹åˆ¥ãƒšãƒ¼ã‚¸</span>
    <div id="linkList3">
      â”œ <a class="menu-item" href="armor-renma.html">ç·´ç£¨(é˜²å…·)ãƒªã‚¹ãƒˆ</a><br>
      â”œ <a class="menu-item" href="armor-top5.html">ç·´ç£¨(é˜²å…·)TOP5ç¢ºèª</a><br>
      â”” <a class="menu-item" href="armor-calc.html">ç·´ç£¨(é˜²å…·)è‡ªå‹•é¸å®šãƒ„ãƒ¼ãƒ«</a><br>
    </div>
    </br>
    <span class="toggle-button" data-target="linkList1">ã‚¢ã‚¤ãƒ†ãƒ ç²å¾—ãƒã‚§ãƒƒã‚«ãƒ¼</span>
    <div id="linkList1">
      â”œ <a class="menu-item" href="checker-4gen.html">å››å…ƒåƒãƒ”ã‚¢ã‚¹ãƒã‚§ãƒƒã‚«ãƒ¼</a></br>
      â”œ <a class="menu-item" href="checker-stella.html">ã‚¹ãƒ†ãƒ©ã‚¤ãƒ¤ãƒªãƒ³ã‚°ãƒã‚§ãƒƒã‚«ãƒ¼</a></br>
      â”” <a class="menu-item" href="checker-niji.html">è™¹ç‘ ç’ƒã®è…•è¼ªãƒã‚§ãƒƒã‚«ãƒ¼</a></br>
    </div>
    <span class="toggle-button" data-target="linkList2">ã‚¢ã‚¤ãƒ†ãƒ ç²å¾—å ±å‘Šç”¨</span>
    <div id="linkList2">
      â”œ <a class="menu-item" href="report-4gen.html">å››å…ƒåƒãƒ”ã‚¢ã‚¹å ±å‘Šç”¨</a></br>
      â”œ <a class="menu-item" href="report-stella.html">ã‚¹ãƒ†ãƒ©ã‚¤ãƒ¤ãƒªãƒ³ã‚°å ±å‘Šç”¨</a></br>
      â”” <a class="menu-item" href="report-niji.html">è™¹ç‘ ç’ƒã®è…•è¼ªå ±å‘Šç”¨</a></br>
    </div>
    </br>
    <a class="menu-item" href="expcalc.html">EXPã‚¹ã‚¿ãƒ³ãƒ—å¿…è¦æ•°è¨ˆç®—</a><br>
    <a class="menu-item" href="https://jessy-rs.github.io/Multi-Stage-Slash/">å¤šæ®µæ–¬ã‚Šã‚¢ãƒ—ãƒª</a><br>
    </br>
    <a class="menu-item"  href="armor.html">è£…å‚™å€™è£œæ¤œç´¢ãƒ„ãƒ¼ãƒ«</a><br>
    <a class="menu-item"  href="style-info.html">ã‚¹ã‚¿ã‚¤ãƒ«æƒ…å ±ãƒ“ãƒ¥ãƒ¼ã‚¢</a><br>
    <br>
    <a class="menu-item"  href="repeat.html">å‘¨å›ç·¨æˆã¾ã¨ã‚</a><br>
    <br>
    <a class="menu-item" href="index.html">ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¸</a><br>
    </br>
  </div>

    <header>
        <h1>
            <span class="hamburger" onclick="toggleMenu()">â˜°</span>ç·´ç£¨(é˜²å…·)ã‚¢ãƒ“ãƒªãƒ†ã‚£ TOP5<span id="screenshot-btn" style="cursor: pointer; margin-left: 10px;">ğŸ“·</span>
        </h1>
    </header>

    <div class="zoom-buttons">
        <button onclick="changeZoom(0.1)">ï¼‹</button>
        <button onclick="changeZoom(-0.1)">ï¼</button>
    </div>

    <div class="controls-container">
        <div class="checkbox-container">
            <label>
                <input type="checkbox" id="include-unique-ability" checked>
                è£…å‚™å›ºæœ‰ã®ã‚¢ãƒ“ãƒªãƒ†ã‚£ã‚‚åŠ å‘³ã™ã‚‹
            </label>
        </div>
        <div class="file-input-container">
            <input type="file" id="json-file-input" accept=".json">
        </div>
    </div>

    <div class="results-grid">
        <div class="category-container" id="main-self">
            <h2>
                â– å¨åŠ›ï¼‹ (ä¸»é˜²å…·)
                <div class="nav-buttons">
                    <button class="nav-button" disabled>â–²</button>
                    <button class="nav-button" onclick="scrollToCategory('sub-self')">â–¼</button>
                </div>
            </h2>
            <div class="table-wrapper"></div>
        </div>
        <div class="category-container" id="sub-self">
            <h2>
                â– å¨åŠ›ï¼‹ (å‰¯é˜²å…·)
                <div class="nav-buttons">
                    <button class="nav-button" onclick="scrollToCategory('main-self')">â–²</button>
                    <button class="nav-button" onclick="scrollToCategory('main-party')">â–¼</button>
                </div>
            </h2>
            <div class="table-wrapper"></div>
        </div>
        <div class="category-container" id="main-party">
            <h2>
                â– å‘³æ–¹å¨åŠ›ï¼‹ (ä¸»é˜²å…·)
                <div class="nav-buttons">
                    <button class="nav-button" onclick="scrollToCategory('sub-self')">â–²</button>
                    <button class="nav-button" onclick="scrollToCategory('sub-party')">â–¼</button>
                </div>
            </h2>
            <div class="table-wrapper"></div>
        </div>
        <div class="category-container" id="sub-party">
            <h2>
                â– å‘³æ–¹å¨åŠ›ï¼‹ (å‰¯é˜²å…·)
                <div class="nav-buttons">
                    <button class="nav-button" onclick="scrollToCategory('main-party')">â–²</button>
                    <button class="nav-button" disabled>â–¼</button>
                </div>
            </h2>
            <div class="table-wrapper"></div>
        </div>
    </div>

    <footer>
<br>
            â€»ä½¿ç”¨ã¯è‡ªå·±è²¬ä»»ã«ã¦ã€‚<br>
            â€»åå°†ã®é§(+15)ã¨ãƒãƒˆãƒ«ãƒ´ã‚¡ãƒ³ãƒ–ãƒ¬ã‚¤ã‚¹(+20)ã®ã‚·ãƒªãƒ¼ã‚ºä¸€è‡´åˆ†ã¯åŠ å‘³ã•ã‚Œã¦ã„ã¾ã›ã‚“ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
    </footer>

    <div class="bottom">
        <a href="armor-renma.html">ãƒªã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¸</a>ã€€<a href="armor-calc.html">è‡ªå‹•é¸å®šãƒ„ãƒ¼ãƒ«ã¸</a>
        <br>
        <a href="index.html">INDEXã¸æˆ»ã‚‹</a>
    </div>

    <script>

    // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é–¢æ•°
    function toggleMenu() {
        const sideMenu = document.getElementById('sideMenu');
        const menuOverlay = document.getElementById('menuOverlay');

        if (sideMenu.classList.contains('open')) {
            closeMenu();
        } else {
            sideMenu.classList.add('open');
            menuOverlay.classList.add('open');
        }
    }

    function closeMenu() {
        const sideMenu = document.getElementById('sideMenu');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuClose = document.getElementById('menuClose');

        sideMenu.classList.remove('open');
        menuOverlay.classList.remove('open');
        menuClose.style.color = '#eee';
    }

    // ãƒ•ãƒªãƒƒã‚¯ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹é–‰ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«èª¤ä½œå‹•å¯¾ç­–ç‰ˆï¼‰
    let startX = 0, startY = 0;
    let endX = 0, endY = 0;

    document.addEventListener('touchstart', function (e) {
      // ã‚¿ãƒƒãƒé–‹å§‹æ™‚ã®Xåº§æ¨™ã¨Yåº§æ¨™ã‚’è¨˜éŒ²
      startX = e.changedTouches[0].screenX;
      startY = e.changedTouches[0].screenY;
    }, false);

    document.addEventListener('touchend', function (e) {
      // ã‚¿ãƒƒãƒçµ‚äº†æ™‚ã®Xåº§æ¨™ã¨Yåº§æ¨™ã‚’è¨˜éŒ²
      endX = e.changedTouches[0].screenX;
      endY = e.changedTouches[0].screenY;
      handleGesture(); // ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ã‚’å‘¼ã³å‡ºã—
    }, false);

    function handleGesture() {
      const diffX = endX - startX; // æ°´å¹³æ–¹å‘ã®ç§»å‹•é‡
      const diffY = endY - startY; // å‚ç›´æ–¹å‘ã®ç§»å‹•é‡

      // æ¡ä»¶1: æ°´å¹³æ–¹å‘ã®ç§»å‹•é‡ãŒã€å‚ç›´æ–¹å‘ã®ç§»å‹•é‡ã‚ˆã‚Šã‚‚å¤§ãã„å ´åˆã®ã¿å‡¦ç†ï¼ˆã‚¹ãƒ¯ã‚¤ãƒ—ã‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‹ã‚’åˆ¤å®šï¼‰
      if (Math.abs(diffX) > Math.abs(diffY)) {

        // æ¡ä»¶2-1: å³ã¸ã®ã‚¹ãƒ¯ã‚¤ãƒ—ï¼ˆ50pxä»¥ä¸Šç§»å‹•ã—ã€ã‹ã¤ç”»é¢ã®å·¦ç«¯30pxä»¥å†…ã‹ã‚‰é–‹å§‹ï¼‰
        if (diffX > 50 && startX < 30) {
          // å³ã«ãƒ•ãƒªãƒƒã‚¯ã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã
          toggleMenu();
        } 
        // æ¡ä»¶2-2: å·¦ã¸ã®ã‚¹ãƒ¯ã‚¤ãƒ—ï¼ˆ50pxä»¥ä¸Šç§»å‹•ï¼‰
        else if (diffX < -50) {
          // å·¦ã«ãƒ•ãƒªãƒƒã‚¯ã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
          closeMenu();
        }
      }
      // å‚ç›´æ–¹å‘ã®ç§»å‹•é‡ãŒå¤§ãã„å ´åˆã¯ã€ä½•ã‚‚ã—ãªã„ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®æ¨™æº–ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ä»»ã›ã‚‹ï¼‰
    }

    // æ‹¡å¤§ç¸®å°ã®é–¢æ•°
    const PAGE_SETTING_KEY = 'PageSettings'; 
    
    let pageSettings = { 'armor-top5_zoom': 1.0 };
    
    function changeZoom(delta) {
        const zoomKey = 'armor-top5_zoom';
        let currentZoom = pageSettings[zoomKey];
    
        currentZoom += delta;

        currentZoom = Math.round(currentZoom * 10) / 10;

        if (currentZoom < 0.5) currentZoom = 0.5;
        if (currentZoom > 2.0) currentZoom = 2.0;
        
        // ç”»é¢ã®è¡¨ç¤ºã«åæ˜ 
        document.body.style.zoom = currentZoom;
        
        // è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ã‚’æ›´æ–°
        pageSettings[zoomKey] = currentZoom;
        
        // localStorageã«ä¿å­˜
        savePageSettings();
    }
    
    function loadPageSettings() {
        try {
            const savedSettings = localStorage.getItem(PAGE_SETTING_KEY);
            if (savedSettings) {
                // ä¿å­˜æ¸ˆã¿ã®è¨­å®šãŒã‚ã‚Œã°ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨çµåˆã—ã¦ä¸Šæ›¸ãã—ã¾ã™ã€‚
                pageSettings = { ...pageSettings, ...JSON.parse(savedSettings) };
            }
        } catch (error) {
            console.error("ãƒšãƒ¼ã‚¸è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
        }
    }
    
    function savePageSettings() {
        try {
            localStorage.setItem(PAGE_SETTING_KEY, JSON.stringify(pageSettings));
        } catch (error) {
            console.error("ãƒšãƒ¼ã‚¸è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
        }
    }

        // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
        let loadedJsonData = null;
        let uniqueAbilities = {};

        // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ---
        function scrollToCategory(categoryId) {
            const element = document.getElementById(categoryId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // --- ãƒ¡ã‚¤ãƒ³å‡¦ç† ---
        document.addEventListener('DOMContentLoaded', () => {
            loadPageSettings();

            const fileInput = document.getElementById('json-file-input');
            const uniqueAbilityCheckbox = document.getElementById('include-unique-ability');

            fileInput.addEventListener('change', handleFileSelect);
            uniqueAbilityCheckbox.addEventListener('change', runAnalysis);

            // CSVãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
            loadUniqueAbilities();

            initializeScreenshot();

            document.body.style.zoom = pageSettings['armor-top5_zoom'];
        });

        // CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’éåŒæœŸã§èª­ã¿è¾¼ã¿ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
        async function loadUniqueAbilities() {
            const files = ['data/armor-main-ability.csv', 'data/armor-sub-ability.csv'];
            const promises = files.map(file => fetch(file).then(response => {
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return response.text();
            }));
            
            try {
                const [mainCsv, subCsv] = await Promise.all(promises);
                uniqueAbilities = parseCsvData(mainCsv + "\n" + subCsv);
            } catch (error) {
                console.error("å›ºæœ‰ã‚¢ãƒ“ãƒªãƒ†ã‚£CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                alert("å›ºæœ‰ã‚¢ãƒ“ãƒªãƒ†ã‚£ãƒ‡ãƒ¼ã‚¿(CSV)ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n'data'ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
            }
        }

        function parseCsvData(csvText) {
            const data = {};
            const attributeMap = { "æ–¬": "æ–¬", "æ‰“": "æ‰“", "çª": "çª", "ç†±": "ç†±", "å†·": "å†·", "é›·": "é›·", "é™½": "é™½", "é™°": "é™°", "å‘³æ–¹å¨åŠ›": "å‘³æ–¹å¨åŠ›", "å¨åŠ›": "å¨åŠ›" };
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            lines.forEach(line => {
                const parts = line.split(',');
                if (parts.length < 3) return;
                const armorName = parts[0].trim();
                const target = parts[1].trim();
                const value = parseInt(parts[2].trim(), 10);

                if (attributeMap[target] && !isNaN(value)) {
                    if (!data[armorName]) {
                        data[armorName] = {};
                    }
                    data[armorName][target] = value;
                }
            });
            return data;
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    loadedJsonData = JSON.parse(e.target.result);
                    runAnalysis(); // æœ€åˆã®è§£æã‚’å®Ÿè¡Œ
                } catch (error) {
                    alert('JSONã®èª­è¾¼ã«å¤±æ•—\n' + error);
                    loadedJsonData = null;
                }
            };
            reader.readAsText(file);
        }

        // è§£æã¨è¡¨ç¤ºã®ãƒ¡ã‚¤ãƒ³é–¢æ•°
        function runAnalysis() {
            if (!loadedJsonData) return;
            try {
                const processed = processData(loadedJsonData);
                displayReport(processed);
            } catch (error) {
                console.error("ãƒ‡ãƒ¼ã‚¿å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼:", error);
                alert("ãƒ‡ãƒ¼ã‚¿å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n" + error);
            }
        }

        function getTargetFromAbilityName(abilityName) {
            if (abilityName.startsWith('å‘³æ–¹å¨åŠ›ï¼‹')) return "å‘³æ–¹å¨åŠ›";
            const match = abilityName.match(/\(([^)]+)\)/);
            if (!match) return null;
            const content = match[1];
            // å±æ€§åã«ç›´æ¥ä¸€è‡´ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const attributes = ["æ–¬", "æ‰“", "çª", "ç†±", "å†·", "é›·", "é™½", "é™°"];
            if (attributes.includes(content)) return content;
            return null;
        }

        function processData(armorData) {
            const selfPowerAbilities = ["å¨åŠ›ï¼‹(HPæº€ã‚¿ãƒ³æ™‚)", "å¨åŠ›ï¼‹(ç€•æ­»æ™‚)", "å¨åŠ›ï¼‹(ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼)", "å¨åŠ›ï¼‹(æ–¬)", "å¨åŠ›ï¼‹(æ‰“)", "å¨åŠ›ï¼‹(çª)", "å¨åŠ›ï¼‹(ç†±)", "å¨åŠ›ï¼‹(å†·)", "å¨åŠ›ï¼‹(é›·)", "å¨åŠ›ï¼‹(é™½)", "å¨åŠ›ï¼‹(é™°)"];
            const partyPowerAbilities = ["å‘³æ–¹å¨åŠ›ï¼‹(HPæº€ã‚¿ãƒ³æ™‚)", "å‘³æ–¹å¨åŠ›ï¼‹(ç€•æ­»æ™‚)", "å‘³æ–¹å¨åŠ›ï¼‹(ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼)", "å‘³æ–¹å¨åŠ›ï¼‹(æ–¬)", "å‘³æ–¹å¨åŠ›ï¼‹(æ‰“)", "å‘³æ–¹å¨åŠ›ï¼‹(çª)", "å‘³æ–¹å¨åŠ›ï¼‹(ç†±)", "å‘³æ–¹å¨åŠ›ï¼‹(å†·)", "å‘³æ–¹å¨åŠ›ï¼‹(é›·)", "å‘³æ–¹å¨åŠ›ï¼‹(é™½)", "å‘³æ–¹å¨åŠ›ï¼‹(é™°)"];
            const includeUnique = document.getElementById('include-unique-ability').checked;

            const categorizedData = { mainSelf: {}, subSelf: {}, mainParty: {}, subParty: {} };
            [...selfPowerAbilities, ...partyPowerAbilities].forEach(name => {
                Object.keys(categorizedData).forEach(cat => categorizedData[cat][name] = []);
            });

            // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ã—ã¦å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
            const dataToProcess = JSON.parse(JSON.stringify(armorData));

            for (const item of dataToProcess) {
                if (!item.abilityName || !item.value) continue;
                let value = parseInt(item.value, 10);
                if (isNaN(value)) continue;

                item.isCombined = false;
                let totalAddedValue = 0;

                // å›ºæœ‰ã‚¢ãƒ“ãƒªãƒ†ã‚£ã‚’åŠ å‘³ã™ã‚‹å ´åˆã®å‡¦ç†
                if (includeUnique && uniqueAbilities[item.armorName]) {
                    const isSpecialArmor = item.armorName.includes("åå°†ã®é§") || item.armorName.includes("ï¾Šï¾ï¾„ï¾™ï½³ï¾ï½§ï¾ï¾Œï¾ï¾šï½²ï½½");

                    // åå°†ã®é§ã¨ãƒãƒˆãƒ«ãƒ´ã‚¡ãƒ³ãƒ–ãƒ¬ã‚¤ã‚¹ã®å ´åˆã¯ã€å›ºæœ‰ã‚¢ãƒ“ãƒªãƒ†ã‚£ã‚’åŠ ç®—ã—ãªã„
                    if (!isSpecialArmor) {
                        const armorBonuses = uniqueAbilities[item.armorName];

                        // 1. å¯¾å¿œã™ã‚‹å±æ€§ã®ãƒœãƒ¼ãƒŠã‚¹ã‚’åŠ ç®—
                        const specificTarget = getTargetFromAbilityName(item.abilityName);
                        if (specificTarget && armorBonuses[specificTarget]) {
                            totalAddedValue += armorBonuses[specificTarget];
                        }

                        // 2. ã€Œå¨åŠ›ï¼‹ã€ç³»ã®å ´åˆã€ã•ã‚‰ã«ã€Œå‘³æ–¹å¨åŠ›ã€ãƒœãƒ¼ãƒŠã‚¹ã‚‚åŠ ç®— (é‡è¤‡ã¯ã—ãªã„)
                        const isSelfPower = selfPowerAbilities.includes(item.abilityName);
                        if (isSelfPower && armorBonuses['å‘³æ–¹å¨åŠ›']) {
                            totalAddedValue += armorBonuses['å‘³æ–¹å¨åŠ›'];
                        }

                        // 3. ã€Œå¨åŠ›ï¼‹ã€ç³»ã®å ´åˆã€ã€Œå¨åŠ›ã€ãƒœãƒ¼ãƒŠã‚¹ã‚‚åŠ ç®—ã™ã‚‹
                        if (isSelfPower && armorBonuses['å¨åŠ›']) {
                            totalAddedValue += armorBonuses['å¨åŠ›'];
                        }
                    }
                }
                
                if (totalAddedValue > 0) {
                    value += totalAddedValue;
                    item.isCombined = true;
                    item.addedValue = totalAddedValue;
                }

                const newItem = { ...item, value };

                if (selfPowerAbilities.includes(item.abilityName)) {
                    if (item.armorType === 'main') categorizedData.mainSelf[item.abilityName].push(newItem);
                    else if (item.armorType === 'sub') categorizedData.subSelf[item.abilityName].push(newItem);
                } else if (partyPowerAbilities.includes(item.abilityName)) {
                    if (item.armorType === 'main') categorizedData.mainParty[item.abilityName].push(newItem);
                    else if (item.armorType === 'sub') categorizedData.subParty[item.abilityName].push(newItem);
                }
            }
            
            for (const category in categorizedData) {
                for (const abilityName in categorizedData[category]) {
                    categorizedData[category][abilityName].sort((a, b) => b.value - a.value);
                }
            }
            return categorizedData;
        }
            
        function displayReport(data) {
            const selfPowerAbilities = ["å¨åŠ›ï¼‹(HPæº€ã‚¿ãƒ³æ™‚)", "å¨åŠ›ï¼‹(ç€•æ­»æ™‚)", "å¨åŠ›ï¼‹(ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼)", "å¨åŠ›ï¼‹(æ–¬)", "å¨åŠ›ï¼‹(æ‰“)", "å¨åŠ›ï¼‹(çª)", "å¨åŠ›ï¼‹(ç†±)", "å¨åŠ›ï¼‹(å†·)", "å¨åŠ›ï¼‹(é›·)", "å¨åŠ›ï¼‹(é™½)", "å¨åŠ›ï¼‹(é™°)"];
            const partyPowerAbilities = ["å‘³æ–¹å¨åŠ›ï¼‹(HPæº€ã‚¿ãƒ³æ™‚)", "å‘³æ–¹å¨åŠ›ï¼‹(ç€•æ­»æ™‚)", "å‘³æ–¹å¨åŠ›ï¼‹(ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼)", "å‘³æ–¹å¨åŠ›ï¼‹(æ–¬)", "å‘³æ–¹å¨åŠ›ï¼‹(æ‰“)", "å‘³æ–¹å¨åŠ›ï¼‹(çª)", "å‘³æ–¹å¨åŠ›ï¼‹(ç†±)", "å‘³æ–¹å¨åŠ›ï¼‹(å†·)", "å‘³æ–¹å¨åŠ›ï¼‹(é›·)", "å‘³æ–¹å¨åŠ›ï¼‹(é™½)", "å‘³æ–¹å¨åŠ›ï¼‹(é™°)"];

            const categories = [
                { id: 'main-self', abilities: selfPowerAbilities, data: data.mainSelf },
                { id: 'sub-self', abilities: selfPowerAbilities, data: data.subSelf },
                { id: 'main-party', abilities: partyPowerAbilities, data: data.mainParty },
                { id: 'sub-party', abilities: partyPowerAbilities, data: data.subParty }
            ];
            
            categories.forEach(cat => {
                const container = document.querySelector(`#${cat.id} .table-wrapper`);
                container.innerHTML = '';
                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th class="col-ability">ã‚¢ãƒ“ãƒªãƒ†ã‚£</th>
                            <th class="col-armor">è£…å‚™</th>
                            <th class="col-value value-col">åŠ¹æœå€¤</th>
                        </tr>
                    </thead>`;
                const tbody = table.createTBody();

                cat.abilities.forEach(abilityName => {
                    const items = cat.data[abilityName] || [];
                    const showTotal = abilityName.startsWith('å‘³æ–¹å¨åŠ›ï¼‹');
                    
                    let abilityTotal = 0;
                    if (showTotal) {
                        for (let i = 0; i < 5; i++) {
                            if (items[i]) abilityTotal += items[i].value;
                        }
                    }

                    for (let i = 0; i < 5; i++) {
                        const item = items[i];
                        const row = tbody.insertRow();
                        
                        let firstCellHTML = '';
                        if (i === 0) {
                            // â˜…ä¿®æ­£ç‚¹1: rowspanã‚’å¸¸ã«4ã«å›ºå®š
                            const rowspan = 4;
                            firstCellHTML = `<td class="merged-ability-cell" rowspan="${rowspan}">${abilityName}</td>`;
                        }
                        // â˜…ä¿®æ­£ç‚¹2: 5è¡Œç›®(i=4)ã®å‡¦ç†ã‚’å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«å¤‰æ›´
                        else if (i === 4) {
                            if (showTotal) {
                                firstCellHTML = `<td class="ability-total-cell">åˆè¨ˆ: ${abilityTotal}%</td>`;
                            } else {
                                // ã€Œå¨åŠ›ï¼‹ã€ç³»ãƒ†ãƒ¼ãƒ–ãƒ«ç”¨ã«ã€ç½«ç·šã‚’è¡¨ç¤ºã•ã›ã‚‹ãŸã‚ã®ç©ºã‚»ãƒ«ã‚’æŒ¿å…¥
                                firstCellHTML = `<td class="ability-total-cell">&nbsp;</td>`;
                            }
                        }

                        let armorCellHTML = '&nbsp;';
                        let valueCellHTML = '&nbsp;';
                        let valueCellClass = 'value-col';

                        if (item) {
                            if (item.isCombined) {
                                armorCellHTML = `<span class="combined-armor-name">${item.armorName} (+${item.addedValue})</span>`;
                                valueCellClass += ' combined-value';
                            } else if (item.armorName.includes("åå°†ã®é§") || item.armorName.includes("ï¾Šï¾ï¾„ï¾™ï½³ï¾ï½§ï¾ï¾Œï¾ï¾šï½²ï½½")) {
                                armorCellHTML = `<span class="special-armor-name">${item.armorName}</span>`;
                            } else {
                                armorCellHTML = item.armorName;
                            }
                            valueCellHTML = item.value + '%';
                        }
                        
                        row.innerHTML = `
                            ${firstCellHTML}
                            <td>${armorCellHTML}</td>
                            <td class="${valueCellClass}">${valueCellHTML}</td>
                        `;
                    }
                });
                container.appendChild(table);
            });
        }

    document.addEventListener("DOMContentLoaded", function(){
      var toggleButtons = document.querySelectorAll(".toggle-button");
    
      toggleButtons.forEach(function(button) {
        var targetId = button.getAttribute("data-target");
        var list = document.getElementById(targetId);
        list.style.display = "none";
    
        button.addEventListener("click", function(){
          if (list.style.display === "block") {
            list.style.display = "none";
          } else {
            list.style.display = "block";
          }
        });
      });
    });

    function initializeScreenshot() {
        const screenshotBtn = document.getElementById('screenshot-btn');
        if (screenshotBtn) {
            screenshotBtn.addEventListener('click', takeScreenshot);
        }
    }

    // dom-to-image-more ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
    async function takeScreenshot() {
        const targetElements = document.querySelectorAll('.category-container');
        if (targetElements.length === 0) {
            alert('æ’®å½±å¯¾è±¡ã®ã‚¨ãƒªã‚¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
            return;
        }

        const screenshotBtn = document.getElementById('screenshot-btn');
        const originalText = screenshotBtn.textContent;
        screenshotBtn.textContent = 'æ’®å½±ä¸­...';
        screenshotBtn.style.cursor = 'default';

        try {
            for (const element of targetElements) {
                const titleElement = element.querySelector('h2');
                const titleText = titleElement.firstChild.textContent.trim().replace('â– ', '').trim();
                const fileName = `ç·´ç£¨é˜²å…·_${titleText.replace(/ /g, '_').replace(/[()]/g, '').replace('ï¼‹', '')}.png`;

                const options = {
                    bgcolor: getComputedStyle(document.body).backgroundColor,
                    width: element.clientWidth * 2,
                    height: element.clientHeight * 2,
                    style: {
                        transform: 'scale(2)',
                        transformOrigin: 'top left',
                        margin: 0
                    }
                };

                const dataUrl = await domtoimage.toPng(element, options);

                const link = document.createElement('a');
                link.download = fileName;
                link.href = dataUrl;
                link.click();
                
                await new Promise(resolve => setTimeout(resolve, 300));
            }

        } catch (error) {
            console.error('ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®æ’®å½±ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            alert('ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®æ’®å½±ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n' + error);
        } finally {
            screenshotBtn.textContent = originalText;
            screenshotBtn.style.cursor = 'pointer';
        }
    }

  </script>

</body>
</html>