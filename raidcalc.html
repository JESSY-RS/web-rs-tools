<!DOCTYPE html>
<html lang="ja">
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="favicon-raidcalc.ico">
  <link rel="apple-touch-icon" href="apple-touch-icon-raidcalc.png">
  <link rel="icon" type="image/png" href="android-chrome-144x144-raidcalc.png">
  <title>７周年制圧戦・報酬効率比較ツール</title> <style>

    body {
      margin: 20px;
      background-color: #2A2A2A;
      color: #eee;
      font-size: 16px;
    }

    #warning {
      color: red;
      margin-top: 10px;
      margin-bottom: 3px;
    }

    /* メッセージエリア */
    #deleteMessage {
      color: #2A2A2A;
      margin-top: 5px;
      /* ▼修正：下の表との余白を広げる */
      margin-bottom: 20px; 
      min-height: 1.2em; 
      font-weight: normal;
      user-select: none;
    }

    h2 {
      font-size: 24px;
      margin-top: 0px;
      margin-bottom: 15px;
    }

    /* タイトルクリック用スタイル */
    #titleTrigger {
      cursor: pointer;
      user-select: none;
    }

    h3 {
      margin-top: 0px;
      margin-bottom: 10px;
    }

    #result1,
    #result2 {
      margin-top: 10px;
      margin-bottom: 0px;
    }

    input,
    select {
      margin: 5px;
      padding: 5px;
      background-color: #fff;
      color: #000;
      border: 1px solid #555;
    }

    .time-inputbox {
      width: 40px;
      text-align: right;
    }

    button {
      margin: 5px;
      padding: 5px 10px;
      color: #fff;
      background-color: #2A99E6;
      border: 1px solid #555;
      cursor: pointer;
    }

    /* 登録ボタン用スタイル */
    .register-btn {
      background-color: #28a745;
      min-width: 60px; /* 横幅は維持 */
      padding: 5px 15px;
    }
    .register-btn:hover {
      background-color: #218838;
    }
    
    /* 無効時のスタイル */
    .register-btn:disabled {
      background-color: #555;
      color: #aaa;
      cursor: not-allowed;
      border: 1px solid #444;
    }

    /* 削除ボタン用スタイル */
    .delete-btn {
      background-color: #dc3545;
    }
    .delete-btn:hover {
      background-color: #c82333;
    }
    .delete-btn:disabled {
      background-color: #555;
      color: #aaa;
      cursor: not-allowed;
      border: 1px solid #444;
    }

    /* ▼▼▼ レイアウト調整用CSS ▼▼▼ */

    /* 入力エリア共通のFlex設定 */
    .input-wrapper, 
    .time-input {
      margin-top: 10px;
      margin-bottom: 15px;
      display: flex;        
      align-items: center;  
      flex-wrap: wrap;      
    }

    /* 分・秒・(+00:13) をひとまとめにして改行させないクラス */
    .input-group-nowrap {
      display: inline-block;
      white-space: nowrap;
    }

    /* 縦並び（固定）モード時のスタイル */
    .force-vertical .input-label-area {
      width: 100%;       
      display: block;    
      margin-bottom: 5px;
    }
    
    /* 横並び時のラベルスタイル */
    .input-label-area {
      margin-right: 5px;
    }

    /* 24Hボタン用のコンテナ */
    .button-row {
      width: 100%;
      margin-top: 5px;
    }

    /* 個数入力エリア */
    .item-input-row {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      margin: 5px 0;
    }
    
    .item-input-row label {
      margin-right: 5px;
    }

    /* ラジオボタンのレイアウト調整 */
    .radio-group {
      margin: 0 0 0 5px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .radio-group label {
      cursor: pointer;
      user-select: none;
    }

    /* 横並びレイアウト用コンテナ */
    #compareContainer {
      display: block; 
    }
    #compareContainer.horizontal {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px; 
    }
    #compareContainer.horizontal .block {
      flex: 1;
      min-width: 300px;
      margin-bottom: 0; 
    }

    .block {
      border: 1px solid #fff;
      padding: 15px;
      margin-bottom: 20px;
    }

    /* ▼修正：逆算パネル（ID指定）の下マージンを詰める */
    #reverseBlock {
      margin-bottom: 10px;
    }

    .error {
      color: #f00;
      margin-top: 5px;
    }

    /* フッターのスタイル */
    footer {
      border-top: 1px solid #eee;
      padding-top: 10px;
      margin-top: 20px;
    }

    /* リンクのスタイル */
    a:link { color: #1D9BF0; text-decoration: underline; }
    a:visited { color: #7755FF; text-decoration: underline; }
    a:hover { color: #0CFF57; }
    a:active { color: #FF0000; text-decoration: underline; }

    .reResult { max-width: 320px; }
    .container { max-width: 500px; }
    .title-box { padding: 8px 0px; text-align: left; }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 0;
    }
    th, td {
      border: 1px solid white;
      padding: 8px 12px;
    }
    thead th {
      background-color: gray;
      text-align: center;
      border-top: 1px solid white;
    }
    td.num { text-align: right; }

    /* グレード換算表本体のスタイル */
    table.grade-table { table-layout: fixed; width: 100%; }
    .grade-table th:nth-of-type(1) { width: 8%; }
    .grade-table th:nth-of-type(2) { width: 25%; }
    .grade-table th:nth-of-type(3) { width: 27%; }
    .grade-table th:nth-of-type(4) { width: 20%; }
    .grade-table th:nth-of-type(5) { width: 20%; }
    .grade-table td { word-wrap: break-word; font-size: 14px; }

    /* ズームボタン */
    .zoom-buttons {
      position: absolute;
      top: 15px;
      right: 15px;
      display: flex;
      flex-direction: row;
      z-index: 1000;
    }
    .zoom-buttons button {
      color: #000;
      background-color: #eee;
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }

    /* ハンバーガーメニュー */
    .hamburger {
      font-size: 24px;
      cursor: pointer;
      margin-right: 3px;
      user-select: none;
      color: #eee;
      display: inline-block;
    }
    .hamburger:hover { color: #2A99E6; }

    .side-menu {
      position: fixed;
      top: 0;
      left: -320px;
      width: 320px;
      min-height: 100vh;
      height: 100%;
      text-align: left;
      background-color: #242424;
      border-right: 1px solid #555;
      transition: left 0.3s ease;
      z-index: 1001;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      overscroll-behavior: contain;
    }
    .side-menu.open { left: 0; }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      min-width: 100vw;
      min-height: 100vh;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }
    .menu-overlay.open { opacity: 1; visibility: visible; }

    .menu-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #eee;
      user-select: none;
    }
    .menu-close:hover { color: #ff6b6b; }

    .menu-title {
      font-size: 20px;
      font-weight: bold;
      text-align: left;
      margin-bottom: 10px;
      color: #FF6E3D;
    }
    .menu-item {
      font-size: 18px;
      text-align: left;
      display: inline-block;
      padding: 6px 0;
      color: #eee;
      text-decoration: none;
    }
    .menu-item:hover { color: #0CFF57; }
    .menu-item:last-child { border-bottom: none; }
    .menu-spacer { height: 30px; }

    .toggle-button {
      cursor: pointer;
      color: #7755FF;
      text-decoration: underline;
      font-size: 18px;
      text-align: left;
      display: block;
      padding: 6px 0;
      user-select: none;
    }
    .toggle-button:hover { color: #0CFF57; text-decoration: underline; }

    #linkList, #linkList1, #linkList2, #linkList3 { display: none; color: #7755FF; }
    #linkList a, #linkList1 a, #linkList2 a, #linkList3 a {
      display: inline-block;
      text-decoration: none;
      color: #7755FF;
    }
    #linkList a:hover, #linkList1 a:hover, #linkList2 a:hover, #linkList3 a:hover {
      text-decoration: underline;
      color: #0CFF57;
    }

    /* ▼▼▼ フッター・レイアウトボタン関連 ▼▼▼ */
    #footerArea {
      margin-bottom: 10px;
      border-top: none;
      display: flex;
      flex-wrap: wrap; /* 折り返し許可 */
      align-items: center;
      gap: 4px; /* ボタン間の余白 */
    }

    /* サブボタン群のコンテナ */
    #subLayoutButtons {
      display: none;
      gap: 4px; /* サブボタン同士の余白 */
    }
    #subLayoutButtons.show {
      display: flex;
      flex-wrap: wrap;
    }

    /* レイアウト切替ボタンの基本スタイル */
    .layout-btn {
      color: #fff;
      border: 1px solid #555;
      padding: 5px 6px; /* 左右の余白を詰める */
      cursor: pointer;
    }

    /* 親ボタン：通常のオレンジ */
    .btn-orange {
      background-color: #ff8c00;
    }
    .btn-orange:hover { background-color: #e07b00; }

    /* 縦並び：強いオレンジ */
    .btn-strong-orange {
      background-color: #ff4500;
    }
    .btn-strong-orange:hover { background-color: #cc3700; }

    /* 横並び：紫 */
    .btn-purple {
      background-color: #9b59b6; 
    }
    .btn-purple:hover { background-color: #8e44ad; }

  </style>

</head>
<body>

  <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>

  <div class="side-menu" id="sideMenu">
    <div class="menu-title">リユニのWeb版いろいろ</div>
    <a class="menu-item" href="kiokucalc.html">記憶再戦時間計算</a><br>
    <a class="menu-item" href="kiokucalc2.html">記憶再戦回数計算</a><br>
    </br>
    <a class="menu-item" href="ikuseicalc.html">育成効率比較ツール</a><br>
    <a class="menu-item" href="raidcalc.html">レイド報酬効率比較ツール</a><br>
    </br>
    <a class="menu-item" href="renma-armor.html">練磨(防具)統合ツール</a><br>
    <span class="toggle-button" data-target="linkList3">練磨(防具)個別ページ</span>
    <div id="linkList3">
      ├ <a class="menu-item" href="armor-renma.html">練磨(防具)リスト</a><br>
      ├ <a class="menu-item" href="armor-top5.html">練磨(防具)TOP5確認</a><br>
      └ <a class="menu-item" href="armor-calc.html">練磨(防具)自動選定ツール</a><br>
    </div>
    </br>
    <span class="toggle-button" data-target="linkList1">アイテム獲得チェッカー</span>
    <div id="linkList1">
      ├ <a class="menu-item" href="checker-4gen.html">四元像ピアスチェッカー</a></br>
      ├ <a class="menu-item" href="checker-stella.html">ステライヤリングチェッカー</a></br>
      └ <a class="menu-item" href="checker-niji.html">虹瑠璃の腕輪チェッカー</a></br>
    </div>
    <span class="toggle-button" data-target="linkList2">アイテム獲得報告用</span>
    <div id="linkList2">
      ├ <a class="menu-item" href="report-4gen.html">四元像ピアス報告用</a></br>
      ├ <a class="menu-item" href="report-stella.html">ステライヤリング報告用</a></br>
      └ <a class="menu-item" href="report-niji.html">虹瑠璃の腕輪報告用</a></br>
    </div>
    </br>
    <a class="menu-item" href="expcalc.html">EXPスタンプ必要数計算</a><br>
    <a class="menu-item" href="https://jessy-rs.github.io/Multi-Stage-Slash/">多段斬りアプリ</a><br>
    </br>
    <a class="menu-item"  href="armor.html">装備候補検索ツール</a><br>
    <a class="menu-item"  href="style-info.html">スタイル情報ビューア</a><br>
    <br>
    <a class="menu-item"  href="repeat.html">周回編成まとめ</a><br>
    <br>
    <a class="menu-item" href="index.html">インデックスページ</a><br>
    </br>
  </div>

  <div class="header">
    <h2><span class="hamburger" onclick="toggleMenu()">☰</span> <span id="titleTrigger" onclick="toggleLayout()">７周年制圧戦・報酬効率比較ツール</span></h2>
  </div>

  <div id="warning">※グレードにより個数が判明していない部分は入力してください。</div>

  <div class="zoom-buttons">
    <button onclick="changeZoom(-0.1)">－</button>
    <button onclick="changeZoom(0.1)">＋</button>
  </div>

  <div id="compareContainer">
    <div class="block">
      <h3>比較①</h3>

      <div class="time-input" id="timeInput1">
        <span class="input-label-area"><label>1回の計測時間：</label></span>
        
        <span class="input-group-nowrap">
          <input class="time-inputbox" type="number" placeholder="分" id="input1-min" min="0"> :
          <input class="time-inputbox" type="number" placeholder="秒" id="input1-sec" min="0">（+00:13）
        </span>
        
        <div class="button-row">
          <button onclick="calculate24h(1)">24Hで回数セット</button>
        </div>
      </div>

      <div class="input-wrapper">
        <label>回数：</label>
        <input type="number" id="countInput1" placeholder="回数を入力" />
      </div>

      <div class="input-wrapper" id="itemSelect1">
        <span class="input-label-area"><label>アイテム選択：</label></span>
        <div class="radio-group">
          <label><input type="radio" name="itemType1" value="shinka" onchange="changeItemType(1)">覇衣進化</label>
          <label><input type="radio" name="itemType1" value="renma" onchange="changeItemType(1)">覇衣練磨</label>
          <label><input type="radio" name="itemType1" value="unkai" onchange="changeItemType(1)">雲海魔晶</label>
          <label><input type="radio" name="itemType1" value="raima" onchange="changeItemType(1)" checked>雷魔の石</label>
        </div>
      </div>

      <label>グレード選択：</label>
      <select id="gradeSelect1" onchange="updateItemValue(1)">
        <option value="0">グレード0</option>
        <option value="6">グレード6</option>
        <option value="7">グレード7</option>
        <option value="8">グレード8</option>
        <option value="9">グレード9</option>
        <option value="10">グレード10</option>
      </select><br>

      <div class="item-input-row">
        <label>個数：</label>
        <input type="number" id="itemPerGame1" step="0.1" oninput="checkRegisterButtonState(1)" />
        <button id="registerBtn1" class="register-btn" onclick="registerUserValue(1)" disabled>登録</button>
      </div>

      <button onclick="calculateResult(1)">計算する</button>

      <h3 id="result1">結果：-</h3>
      <div class="error" id="error1" style="display:none;"></div>
    </div>

    <div class="block">
      <h3>比較②</h3>

      <div class="time-input" id="timeInput2">
        <span class="input-label-area"><label>1回の計測時間：</label></span>
        
        <span class="input-group-nowrap">
          <input class="time-inputbox" type="number" placeholder="分" id="input2-min" min="0"> :
          <input class="time-inputbox" type="number" placeholder="秒" id="input2-sec" min="0">（+00:13）
        </span>

        <div class="button-row">
          <button onclick="calculate24h(2)">24Hで回数セット</button>
        </div>
      </div>

      <div class="input-wrapper">
        <label>回数：</label>
        <input type="number" id="countInput2" placeholder="回数を入力" />
      </div>

      <div class="input-wrapper" id="itemSelect2">
        <span class="input-label-area"><label>アイテム選択：</label></span>
        <div class="radio-group">
          <label><input type="radio" name="itemType2" value="shinka" onchange="changeItemType(2)">覇衣進化</label>
          <label><input type="radio" name="itemType2" value="renma" onchange="changeItemType(2)">覇衣練磨</label>
          <label><input type="radio" name="itemType2" value="unkai" onchange="changeItemType(2)">雲海魔晶</label>
          <label><input type="radio" name="itemType2" value="raima" onchange="changeItemType(2)" checked>雷魔の石</label>
        </div>
      </div>

      <label>グレード選択：</label>
      <select id="gradeSelect2" onchange="updateItemValue(2)">
        <option value="0">グレード0</option>
        <option value="6">グレード6</option>
        <option value="7">グレード7</option>
        <option value="8">グレード8</option>
        <option value="9">グレード9</option>
        <option value="10" selected>グレード10</option>
      </select><br>

      <div class="item-input-row">
        <label>個数：</label>
        <input type="number" id="itemPerGame2" step="0.1" oninput="checkRegisterButtonState(2)" />
        <button id="registerBtn2" class="register-btn" onclick="registerUserValue(2)" disabled>登録</button>
      </div>

      <button onclick="calculateResult(2)">計算する</button>

      <h3 id="result2">結果：-</h3>
      <div class="error" id="error2" style="display:none;"></div>
    </div>
  </div>
  
  <div class="block" id="reverseBlock">
    <h3>目標個数から逆算</h3>

    <button onclick="setTargetFromResult(1)">比較①の結果をセット</button>
    <button onclick="setTargetFromResult(2)">比較②の結果をセット</button>
    <br>

    <label>目標個数：</label>
    <input type="number" id="targetItemCount" placeholder="個数を入力" /><br>

    <button onclick="calculateReverse()">逆算する</button>

    <h3>結果</h3>
    <div class="reResult" id="reverseResult"></div>
    <div id="reverseMessage" style="margin-top:10px; font-weight:bold;"></div>
    <div class="error" id="error3" style="display:none;"></div>
  </div>

  <div id="footerArea">
    <button id="deleteUserProfileBtn" class="delete-btn" onclick="deleteUserProfiles()" disabled>ユーザー別に登録した個数を削除</button>
    
    <button id="showLayoutMenuBtn" class="layout-btn btn-orange" onclick="toggleLayoutMenu()">表示レイアウト変更</button>
    
    <div id="subLayoutButtons">
      <button id="timeLayoutBtn" class="layout-btn" onclick="toggleTimeLayout()">計測時間欄・縦並び(固定)</button>
      <button id="itemLayoutBtn" class="layout-btn" onclick="toggleItemLayout()">アイテム欄・縦並び(固定)</button>
    </div>
  </div>
  <div id="deleteMessage">メッセージエリア</div>

  <div class="container">
    <div class="title-box">■グレード⇆ダメージ換算早見表</div>

    <table class="grade-table">
      <thead>
        <tr>
          <th>Gr.</th>
          <th>シムメシュ<br>アレツ<br>ノーア</th>
          <th>シャムマベル<br>ラスボス</th>
          <th>成長判定回数</th>
          <th>ボーナス倍率</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">0</td>
          <td class="num">0</td>
          <td class="num">0</td>
          <td class="num">3回</td>
          <td class="num">1.00倍</td>
        </tr>
        <tr>
          <td class="num">6</td>
          <td class="num">5億</td>
          <td class="num">5億</td>
          <td class="num">8回</td>
          <td class="num">2.90倍</td>
        </tr>
        <tr>
          <td class="num">7</td>
          <td class="num">10億</td>
          <td class="num">10億</td>
          <td class="num">9回</td>
          <td class="num">3.60倍</td>
        </tr>
        <tr>
          <td class="num">8</td>
          <td class="num">50億</td>
          <td class="num">30億</td>
          <td class="num">10回</td>
          <td class="num">4.35倍</td>
        </tr>
        <tr>
          <td class="num">9</td>
          <td class="num">100億</td>
          <td class="num">50億</td>
          <td class="num">15回</td>
          <td class="num">7.00倍</td>
        </tr>
        <tr>
          <td class="num">10</td>
          <td class="num">200億</td>
          <td class="num">100億</td>
          <td class="num">20回</td>
          <td class="num">9.30倍</td>
        </tr>
      </tbody>
    </table>
  </div>

  <br>
  <br>

  ■関連記事<br>
  <a href="https://x.com/jessy_romasaga/status/1995811478390161728">https://x.com/jessy_romasaga/status/1995811478390161728</a><br>
  <a href="https://x.com/jessy_romasaga/status/1995511608219767026">https://x.com/jessy_romasaga/status/1995511608219767026</a><br>
  <a href="https://x.com/jessy_romasaga/status/1994728915689246767">https://x.com/jessy_romasaga/status/1994728915689246767</a><br>

  <footer>
    ※使用は自己責任にて。<br>
    ※ページをリロードすると各項目が初期値に戻ります。<br>
    <br>
    <a href="index.html">INDEXへ戻る</a><br>
  </footer>

  <script>
    // ハンバーガーメニュー関連
    function toggleMenu() {
        const sideMenu = document.getElementById('sideMenu');
        const menuOverlay = document.getElementById('menuOverlay');
        if (sideMenu.classList.contains('open')) {
            closeMenu();
        } else {
            sideMenu.classList.add('open');
            menuOverlay.classList.add('open');
        }
    }

    function closeMenu() {
        const sideMenu = document.getElementById('sideMenu');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuClose = document.getElementById('menuClose');
        sideMenu.classList.remove('open');
        menuOverlay.classList.remove('open');
        if(menuClose) menuClose.style.color = '#eee';
    }

    // フリック操作関連・ズーム操作関連
    let startX = 0, startY = 0;
    let endX = 0, endY = 0;

    document.addEventListener('touchstart', function (e) {
      startX = e.changedTouches[0].screenX;
      startY = e.changedTouches[0].screenY;
    }, false);

    document.addEventListener('touchend', function (e) {
      endX = e.changedTouches[0].screenX;
      endY = e.changedTouches[0].screenY;
      handleGesture();
    }, false);

    function handleGesture() {
      const diffX = endX - startX;
      const diffY = endY - startY;
      if (Math.abs(diffX) > Math.abs(diffY)) {
        if (diffX > 50 && startX < 30) {
          toggleMenu();
        } 
        else if (diffX < -50) {
          closeMenu();
        }
      }
    }

    const PAGE_SETTING_KEY = 'PageSettings'; 
    // デフォルト設定
    // raidcalc_layout_time: 1=縦並び(固定), 0=横並び(自動)
    // raidcalc_layout_item: 1=縦並び(固定), 0=横並び(自動)
    let pageSettings = { 
        'raidcalc_zoom': 1.0, 
        'raidcalc_column': 1,
        'raidcalc_layout_time': 1,
        'raidcalc_layout_item': 1
    };
    
    function changeZoom(delta) {
        const zoomKey = 'raidcalc_zoom';
        let currentZoom = pageSettings[zoomKey];
        currentZoom += delta;
        currentZoom = Math.round(currentZoom * 10) / 10;
        if (currentZoom < 0.5) currentZoom = 0.5;
        if (currentZoom > 2.0) currentZoom = 2.0;
        document.body.style.zoom = currentZoom;
        pageSettings[zoomKey] = currentZoom;
        savePageSettings();
    }

    // レイアウト切り替え機能（ブロックの1列/2列）
    function toggleLayout() {
      // 1=縦, 2=横。現在の値を反転
      const current = pageSettings['raidcalc_column'] || 1;
      pageSettings['raidcalc_column'] = current === 1 ? 2 : 1;
      
      applyLayout();
      savePageSettings();
    }

    // レイアウト適用（ブロックの1列/2列）
    function applyLayout() {
      const container = document.getElementById('compareContainer');
      const isHorizontal = pageSettings['raidcalc_column'] === 2;
      
      if (isHorizontal) {
        container.classList.add('horizontal');
      } else {
        container.classList.remove('horizontal');
      }
    }

    // ▼▼▼ レイアウト操作ロジック ▼▼▼

    // 親ボタンを押したときのメニュー開閉
    function toggleLayoutMenu() {
        const menu = document.getElementById('subLayoutButtons');
        const msgDiv = document.getElementById("deleteMessage"); // メッセージエリア
        
        if (menu.classList.contains('show')) {
            menu.classList.remove('show');
            msgDiv.textContent = "メッセージエリア";
            msgDiv.style.color = "#2A2A2A";
        } else {
            menu.classList.add('show');
            msgDiv.textContent = "※比較パネル自体の縦並び(固定)と横並び(自動)はタイトル部分をクリックする事で可能です。(モニター幅が十分にない場合は切り替わりません。)";
            // ▼修正：色を赤に変更
            msgDiv.style.color = "red";
        }
    }

    // 計測時間欄のレイアウト切替
    function toggleTimeLayout() {
        const current = pageSettings['raidcalc_layout_time'];
        pageSettings['raidcalc_layout_time'] = (current === 1) ? 0 : 1;
        applyTimeLayout();
        savePageSettings();
    }

    // アイテム欄のレイアウト切替
    function toggleItemLayout() {
        const current = pageSettings['raidcalc_layout_item'];
        pageSettings['raidcalc_layout_item'] = (current === 1) ? 0 : 1;
        applyItemLayout();
        savePageSettings();
    }

    function applyTimeLayout() {
        const isVertical = (pageSettings['raidcalc_layout_time'] === 1);
        const btn = document.getElementById('timeLayoutBtn');
        
        // 比較1と比較2の両方に適用
        const targets = [document.getElementById('timeInput1'), document.getElementById('timeInput2')];
        
        targets.forEach(el => {
            if (el) {
                if (isVertical) el.classList.add('force-vertical');
                else el.classList.remove('force-vertical');
            }
        });

        if (btn) {
            if (isVertical) {
                btn.textContent = "計測時間欄・縦並び(固定)";
                btn.className = "layout-btn btn-strong-orange";
            } else {
                btn.textContent = "計測時間欄・横並び(自動)";
                btn.className = "layout-btn btn-purple";
            }
        }
    }

    function applyItemLayout() {
        const isVertical = (pageSettings['raidcalc_layout_item'] === 1);
        const btn = document.getElementById('itemLayoutBtn');
        
        const targets = [document.getElementById('itemSelect1'), document.getElementById('itemSelect2')];
        
        targets.forEach(el => {
            if (el) {
                if (isVertical) el.classList.add('force-vertical');
                else el.classList.remove('force-vertical');
            }
        });

        if (btn) {
            if (isVertical) {
                btn.textContent = "アイテム欄・縦並び(固定)";
                btn.className = "layout-btn btn-strong-orange";
            } else {
                btn.textContent = "アイテム欄・横並び(自動)";
                btn.className = "layout-btn btn-purple";
            }
        }
    }
    
    function loadPageSettings() {
        try {
            const savedSettings = localStorage.getItem(PAGE_SETTING_KEY);
            if (savedSettings) {
                pageSettings = { ...pageSettings, ...JSON.parse(savedSettings) };
            }
        } catch (error) {
            console.error("ページ設定の読み込みに失敗しました:", error);
        }
    }
    
    function savePageSettings() {
        try {
            localStorage.setItem(PAGE_SETTING_KEY, JSON.stringify(pageSettings));
        } catch (error) {
            console.error("ページ設定の保存に失敗しました:", error);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadPageSettings();
        document.body.style.zoom = pageSettings['raidcalc_zoom'];
        applyLayout();       // 全体レイアウト
        applyTimeLayout();   // 計測時間のレイアウト適用
        applyItemLayout();   // アイテムのレイアウト適用
    });


    /* --------------------------------------------------
       データ設定エリア
       -------------------------------------------------- */
    const initialValues = {
      inputMin: '',
      inputSec: '',
      countInput: '',
    };

    // ▼▼▼ アイテムごとのグレードデータ（デフォルト） ▼▼▼
    const itemData = {
      // 覇衣進化
      shinka: {
        0: null, 6: null, 7: 92.4, 8: null, 9: 109.9, 10: 115.3
      },
      // 覇衣練磨
      renma: {
        0: null, 6: null, 7: 77.5, 8: null, 9: 101.1, 10: 111.9
      },
      // 雲海魔晶
      unkai: {
        0: null, 6: null, 7: 3239.9, 8: null, 9: 5052.3, 10: 6068.3
      },
      // 雷魔の石（既存データ）
      raima: {
        0: null, 6: null, 7: 276.6, 8: null, 9: 458.2, 10: 559.3
      }
    };

    // ユーザー登録データ
    let userItemData = {};

    // ページロード時の処理
    window.onload = function () {
      // ユーザーデータの読み込み
      loadUserData();

      // 初期値を各項目へセット
      document.getElementById('input1-min').value = initialValues.inputMin;
      document.getElementById('input1-sec').value = initialValues.inputSec;
      document.getElementById('input2-min').value = initialValues.inputMin;
      document.getElementById('input2-sec').value = initialValues.inputSec;
      
      document.getElementById('countInput1').value = initialValues.countInput;
      document.getElementById('countInput2').value = initialValues.countInput;

      document.getElementById('gradeSelect1').value = "7";
      document.getElementById('gradeSelect2').value = "10";
      
      document.getElementById('targetItemCount').value = "";

      // 初期状態の計算（雷魔の石がデフォルト）
      updateItemValue(1);
      updateItemValue(2);

      // 全選択機能のセットアップ
      setupAutoSelect();
    }

    /* --------------------------------------------------
       ロジック
       -------------------------------------------------- */

    // 入力欄の全選択機能
    function setupAutoSelect() {
      const inputs = document.querySelectorAll('input[type="number"]');
      inputs.forEach(function(input) {
        input.addEventListener('focus', function() { this.select(); });
        input.addEventListener('click', function() { this.select(); });
      });
    }

    // ▼▼▼ ユーザーデータの管理 ▼▼▼
    function loadUserData() {
      const stored = localStorage.getItem('raidcalc_user_item_data');
      if (stored) {
        try {
          userItemData = JSON.parse(stored);
        } catch (e) {
          userItemData = {};
        }
      }
      updateDeleteButtonState();
    }

    function saveUserData() {
      localStorage.setItem('raidcalc_user_item_data', JSON.stringify(userItemData));
      updateDeleteButtonState();
    }

    function updateDeleteButtonState() {
      const btn = document.getElementById('deleteUserProfileBtn');
      // データが存在するかチェック
      if (Object.keys(userItemData).length > 0) {
        btn.disabled = false;
      } else {
        btn.disabled = true;
      }
    }

    function registerUserValue(number) {
      const grade = document.getElementById(`gradeSelect${number}`).value;
      const currentType = getCurrentItemType();
      const val = document.getElementById(`itemPerGame${number}`).value;

      if (val === "") return;

      if (!userItemData[currentType]) userItemData[currentType] = {};
      userItemData[currentType][grade] = parseFloat(val);

      saveUserData();

      // 両方の表示を更新（同じアイテム・グレードを選択している可能性があるため）
      updateItemValue(1);
      updateItemValue(2);
      
      // メッセージなし
    }
    
    // ▼▼▼ ボタンの活性/非活性を制御する関数 ▼▼▼
    function checkRegisterButtonState(number) {
      const grade = document.getElementById(`gradeSelect${number}`).value;
      const currentType = getCurrentItemType();
      const inputVal = document.getElementById(`itemPerGame${number}`).value;
      const btn = document.getElementById(`registerBtn${number}`);

      // 現在保存されている値（Source of Truth）を取得
      let storedVal = null;
      if (userItemData[currentType] && userItemData[currentType][grade] !== undefined && userItemData[currentType][grade] !== null) {
          storedVal = userItemData[currentType][grade];
      } else {
          storedVal = itemData[currentType][grade];
      }

      const strStored = (storedVal === null || storedVal === undefined) ? "" : String(storedVal);
      const strInput = String(inputVal);

      if (strStored !== strInput) {
        btn.disabled = false;
      } else {
        btn.disabled = true;
      }
    }

    function deleteUserProfiles() {
      const confirmed = window.confirm("プロファイルに登録されているユーザー別の個数の情報を削除してよろしいですか？");
      if (!confirmed) {
          return;
      }

      localStorage.removeItem('raidcalc_user_item_data');
      userItemData = {};
      
      // 表示を更新（デフォルト値に戻る）
      updateItemValue(1);
      updateItemValue(2);
      
      updateDeleteButtonState();

      // 完了メッセージ表示
      const msgDiv = document.getElementById("deleteMessage");
      msgDiv.textContent = "※プロファイルの情報を削除しました。";
      msgDiv.style.color = "red"; 
    }

    // ▼▼▼ ラジオボタンの同期と更新処理 ▼▼▼
    function changeItemType(sourceNumber) {
      // 変更された側の値を取得
      const selectedValue = document.querySelector(`input[name="itemType${sourceNumber}"]:checked`).value;
      
      // もう片方の番号を特定（1なら2、2なら1）
      const targetNumber = sourceNumber === 1 ? 2 : 1;
      
      // もう片方のラジオボタンを同じ値にする
      const targetRadios = document.getElementsByName(`itemType${targetNumber}`);
      targetRadios.forEach(radio => {
        radio.checked = (radio.value === selectedValue);
      });

      // 両方の入力欄の数値を、選択されたアイテム・グレードに合わせて更新
      updateItemValue(1);
      updateItemValue(2);
      
      // 逆算結果が表示されている場合はリセット
      document.getElementById("reverseResult").innerHTML = "";
      document.getElementById("reverseMessage").textContent = "";

      const msgDiv = document.getElementById("deleteMessage");
      msgDiv.textContent = "メッセージエリア";
      msgDiv.style.color = "#2A2A2A";
    }

    function getCurrentItemType() {
      const radio = document.querySelector('input[name="itemType1"]:checked');
      return radio ? radio.value : 'raima';
    }

    function updateItemValue(number) {
      const grade = document.getElementById(`gradeSelect${number}`).value;
      const currentType = getCurrentItemType(); 
      
      let val = null;

      if (userItemData[currentType] && userItemData[currentType][grade] !== undefined && userItemData[currentType][grade] !== null) {
          val = userItemData[currentType][grade];
      } else {
          val = itemData[currentType][grade];
      }

      if (val === null || val === undefined) {
        document.getElementById(`itemPerGame${number}`).value = "";
      } else {
        document.getElementById(`itemPerGame${number}`).value = val;
      }

      const btn = document.getElementById(`registerBtn${number}`);
      if(btn) {
        btn.disabled = true;
      }
    }

    function calculateResult(number) {
      const count = Number(document.getElementById(`countInput${number}`).value);
      const errorDiv = document.getElementById(`error${number}`);
      
      if (isNaN(count) || count <= 0) {
        errorDiv.style.display = "block";
        errorDiv.textContent = `※比較${number}の回数を正しく入力してください。`;
        document.getElementById(`result${number}`).textContent = "結果：-";
        return;
      }
      
      const itemInputVal = document.getElementById(`itemPerGame${number}`).value;
      
      if (itemInputVal === "") {
        errorDiv.style.display = "block";
        errorDiv.textContent = `※比較${number}の個数が入力されていません。`;
        document.getElementById(`result${number}`).textContent = "結果：-";
        return;
      }

      const perGame = Number(itemInputVal);
      errorDiv.style.display = "none";
      const total = Math.floor(count * perGame);
      document.getElementById(`result${number}`).textContent = `結果：${total.toLocaleString()}個`;
    }

    function calculate24h(number) {
      const min = parseInt(document.getElementById(`input${number}-min`).value) || 0;
      const sec = parseInt(document.getElementById(`input${number}-sec`).value) || 0;
      const oneTime = min * 60 + sec + 13; 
      const totalTime = 86400; 
      const errorDiv = document.getElementById(`error${number}`);

      if (oneTime === 13) { 
        errorDiv.style.display = "block";
        errorDiv.textContent = `※計測時間${number}を入力してください。`;
        return;
      }
      errorDiv.style.display = "none";
      const resultCount = Math.floor(totalTime / oneTime);
      document.getElementById(`countInput${number}`).value = resultCount;
    }

    function calculateReverse() {
      const targetItemCount = Number(document.getElementById("targetItemCount").value);
      const resultDiv = document.getElementById("reverseResult");
      resultDiv.innerHTML = "";

      if (isNaN(targetItemCount) || targetItemCount <= 0) {
        document.getElementById("reverseMessage").textContent = "";
        resultDiv.innerHTML = "<div class='error'>※目標個数を正しく入力してください。</div>";
        return;
      }

      const currentType = getCurrentItemType();
      
      // 計算対象のグレード一覧（固定）
      const gradesToCheck = [0, 6, 7, 8, 9, 10];

      let output = `<table border="1" cellspacing="0" cellpadding="5">
        <thead>
          <tr>
            <th style="text-align:center;">Gr.</th>
            <th style="text-align:center;">必要回数</th>
            <th style="text-align:center;">1回の計測時間</th>
          </tr>
        </thead>
        <tbody>`;

      const totalTime = 86400; 
      function formatTimeWithOffset(seconds) {
        const adjusted = Math.max(0, seconds - 13);
        const mm = Math.floor(adjusted / 60).toString().padStart(2, "0");
        const ss = (adjusted % 60).toString().padStart(2, "0");
        return `${mm}:${ss}(+00:13)`;
      }

      for (const grade of gradesToCheck) {
        let perGame = null;

        if (userItemData[currentType] && userItemData[currentType][grade] !== undefined && userItemData[currentType][grade] !== null) {
            perGame = userItemData[currentType][grade];
        } else {
            perGame = itemData[currentType][grade];
        }

        if (perGame === null || perGame === 0 || perGame === undefined) continue;

        const requiredCount = Math.ceil(targetItemCount / perGame);
        const oneLapTime = Math.floor(totalTime / requiredCount);

        output += `<tr>
          <td style="text-align:right;">${grade}</td>
          <td style="text-align:right;">${requiredCount.toLocaleString()}</td>
          <td style="text-align:right;">${formatTimeWithOffset(oneLapTime)}</td>
        </tr>`;
      }

      output += "</tbody></table>";
      resultDiv.innerHTML = output;
      document.getElementById("reverseMessage").textContent = "上記タイム未満で周回可能ならば報酬量は上回ります。";
    }

    function setTargetFromResult(number) {
      const resultText = document.getElementById(`result${number}`).textContent;
      const match = resultText.match(/結果：([\d,]+)個/);
      const reverseResultDiv = document.getElementById("reverseResult");
      reverseResultDiv.innerHTML = "";

      if (resultText === "結果：-" || !match) {
        document.getElementById("reverseMessage").textContent = "";
        reverseResultDiv.innerHTML += `<div class="error">※比較${number}が計算されていません。</div>`;
        return;
      }
      if (match) {
        const count = Number(match[1].replace(/,/g, ''));
        if (!isNaN(count)) {
          document.getElementById('targetItemCount').value = count;
        }
      }
    }
    
    // サイドメニューのトグル設定
    document.addEventListener("DOMContentLoaded", function(){
      var toggleButtons = document.querySelectorAll(".toggle-button");
      toggleButtons.forEach(function(button) {
        var targetId = button.getAttribute("data-target");
        var list = document.getElementById(targetId);
        if(list){
             list.style.display = "none";
             button.addEventListener("click", function(){
               if (list.style.display === "block") {
                 list.style.display = "none";
               } else {
                 list.style.display = "block";
               }
             });
        }
      });
    });
  </script>

</body>
</html>