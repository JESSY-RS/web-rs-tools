<!DOCTYPE html>
<html lang="ja">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="favicon-stella.ico">
  <link rel="apple-touch-icon" href="apple-touch-icon-stella.png">
  <link rel="icon" type="image/png" href="web-app-manifest-192x192-stella.png">
  <title>ステライヤリング報告用</title> <!-- Created by じぇ -->

  <style>

    body {
      margin: 20px;
      background-color: #2A2A2A;
      color: #eee;
      text-align: center;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .pierce-group {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 10px;
      margin: 10px;
      margin-top: 5px;
      justify-content: center;
    }

    .pierce-category {
      border: 1px solid #ccc;
      padding: 5px;
    }

    .pierce-category h2 {
      font-size: 18px;
      margin: 3px 0;
    }


    /* 小分類と星の横並び中央寄せ */
    .attribute {
      font-size: 22px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 5px;
      margin-left: -26px;
      margin-right: 10px;
      margin-bottom: -16px;
    }

    /* 小分類（左側）は右揃え、幅固定 */
    .attribute span:first-child {
      width: 100px;
      text-align: right;
      margin-right: 0px;
    }

    /* 星（右側）は左揃え */
    .attribute .stars {
      text-align: left;
    }

    .stars {
      font-size: 26px;
    }

    input[type="file"] {
      margin: 10px 0;
      font-size: 12px;
    }

    /* 小分類ごとの色指定 */
    .S01 { color: darkorange; }
    .S03 { color: darkorange; }
    .S05 { color: darkorange; }
    .S07 { color: yellow; }
    .S09 { color: yellow; }
    .S11 { color: yellow; }
    .S13 { color: yellow; }
    .S15 { color: lime; }
    .S17 { color: lime; }
    .S19 { color: lime; }
    .S21 { color: lime; }
    .S23 { color: lime; }
    .S25 { color: deepskyblue; }
    .S02 { color: deepskyblue; }
    .S04 { color: deepskyblue; }
    .S06 { color: deepskyblue; }
    .S08 { color: orangered; }
    .S10 { color: orangered; }
    .S12 { color: orangered; }
    .S14 { color: darkgray; }
    .S16 { color: darkgray; }
    .S18 { color: darkgray; }
    .S20 { color: darkgray; }
    .S22 { color: dodgerblue; }
    .S24 { color: dodgerblue; }
    .S26 { color: darkorchid; }

    /* 集計部分のスタイル */
    #summary {
      margin-top: 30px;
      text-align: center;
      font-size: 16px;
    }

    /* 拡大縮小ボタンのスタイル */
    .zoom-buttons {
      position: fixed;
      top: 15px;
      right: 15px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 1000;
    }

    .zoom-buttons button {
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    /* リンクのスタイル */
    a:link {
      color: #1D9BF0;
      text-decoration: underline;
    }

    a:visited {
      color: #7755FF;
      text-decoration: underline;
    }

    a:hover {
      color: #0CFF57;
    }

    a:active {
      color: #FF0000;
      text-decoration: underline;
    }

    /* ハンバーガーメニューのスタイル */
    .hamburger {
      font-size: 24px;
      cursor: pointer;
      margin-left: -5px;
      margin-right: 3px;
      user-select: none;
      color: #eee;
      display: inline-block;
    }
    
    .hamburger:hover {
      color: #2A99E6;
    }

    .side-menu {
      position: fixed;
      top: 0;
      left: -320px;
      width: 320px;
      min-height: 100vh;
      height: 100%;
      text-align: left;
      background-color: #242424;
      border-right: 1px solid #555;
      transition: left 0.3s ease;
      z-index: 1000;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .side-menu.open {
      left: 0;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      min-width: 100vw;
      min-height: 100vh;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .menu-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .menu-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #eee;
      user-select: none;
    }

    .menu-close:hover {
      color: #ff6b6b;
    }

    .menu-title {
      font-size: 18px;
      font-weight: bold;
      text-align: left;
      margin-bottom: 10px;
      color: #2A99E6;
    }

    .menu-item {
      font-size: 18px;
      text-align: left;
      display: inline-block;
      padding: 12px 0;
      color: #eee;
      text-decoration: none;
    }

    .menu-item:hover {
      color: #0CFF57;
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .menu-spacer {
      height: 30px;
    }

  </style>

</head>
<body>

  <!-- サイドメニューオーバーレイ -->
  <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>

  <!-- サイドメニュー -->
  <div id="sidemenu-container"></div>

  <!-- ハンバーガーメニューとヘッダー -->
  <div class="header">
    <h1><span class="hamburger" onclick="toggleMenu()">☰</span> ステライヤリング</h1>
  </div>

  <div class="zoom-buttons">
    <button onclick="changeZoom(0.1)">＋</button>
    <button onclick="changeZoom(-0.1)">－</button>
  </div>

  <input type="file" id="importJson" accept=".json">

  <div class="pierce-group" id="pierceGroup"></div>

  <div id="summary"></div>

  <br><a href="checker-stella.html">チェッカーへ戻る</a><br>

  <script>

    // サイドメニューの特定項目の表示設定
    // キー：表示/非表示を切り替えたい要素のID
    // 値：その要素を表示したいページの<title>の配列
    const sideMenuVisibilityConfig = {
      'variable-links-4gen': ['四元像ピアスチェッカー']
    };

    // サイドメニューを呼び出し、表示内容を制御する関数
    function loadSideMenu() {
      fetch('sidemenu-c.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('sidemenu-container').innerHTML = data;

          // 現在のページのタイトルを取得
          const currentPageTitle = document.title;

          // 設定に基づいてメニュー項目の表示/非表示を切り替え
          for (const elementId in sideMenuVisibilityConfig) {
            const targetElement = document.getElementById(elementId);
            if (targetElement) {
              const visiblePages = sideMenuVisibilityConfig[elementId];
              // 表示対象ページの配列に現在のページタイトルが含まれているかチェック
              if (visiblePages.includes(currentPageTitle)) {
                targetElement.style.display = 'block'; // 表示
              } else {
                targetElement.style.display = 'none';  // 非表示
              }
            }
          }

          // 元のコードにあったトグルボタン用の処理（もし存在すれば）
          var toggleButtons = document.querySelectorAll(".toggle-button");
          toggleButtons.forEach(function(button) {
            var targetId = button.getAttribute("data-target");
            var list = document.getElementById(targetId);
            button.addEventListener("click", function(){
              if (list.style.display === "block") {
                list.style.display = "none";
              } else {
                list.style.display = "block";
              }
            });
          });
        });
    }

    // ハンバーガーメニューの関数
    function toggleMenu() {
        const sideMenu = document.getElementById('sideMenu');
        if (!sideMenu) return;
        const menuOverlay = document.getElementById('menuOverlay');

        if (sideMenu.classList.contains('open')) {
            closeMenu();
        } else {
            sideMenu.classList.add('open');
            menuOverlay.classList.add('open');
        }
    }

    function closeMenu() {
        const sideMenu = document.getElementById('sideMenu');
        if (!sideMenu) return;
        const menuOverlay = document.getElementById('menuOverlay');

        sideMenu.classList.remove('open');
        menuOverlay.classList.remove('open');
    }

    // フリックでメニュー開閉（スクロール誤作動対策版）
    let startX = 0, startY = 0;
    let endX = 0, endY = 0;

    document.addEventListener('touchstart', function (e) {
      // タッチ開始時のX座標とY座標を記録
      startX = e.changedTouches[0].screenX;
      startY = e.changedTouches[0].screenY;
    }, false);

    document.addEventListener('touchend', function (e) {
      // タッチ終了時のX座標とY座標を記録
      endX = e.changedTouches[0].screenX;
      endY = e.changedTouches[0].screenY;
      handleGesture(); // ジェスチャーを判定する関数を呼び出し
    }, false);

    function handleGesture() {
      const diffX = endX - startX; // 水平方向の移動量
      const diffY = endY - startY; // 垂直方向の移動量

      // 条件1: 水平方向の移動量が、垂直方向の移動量よりも大きい場合のみ処理（スワイプかスクロールかを判定）
      if (Math.abs(diffX) > Math.abs(diffY)) {

        // 条件2-1: 右へのスワイプ（50px以上移動し、かつ画面の左端30px以内から開始）
        if (diffX > 50 && startX < 30) {
          // 右にフリックしてメニューを開く
          toggleMenu();
        } 
        // 条件2-2: 左へのスワイプ（50px以上移動）
        else if (diffX < -50) {
          // 左にフリックしてメニューを閉じる
          closeMenu();
        }
      }
      // 垂直方向の移動量が大きい場合は、何もしない（ブラウザの標準スクロールに任せる）
    }

    const pierceGroup = document.getElementById("pierceGroup");
    
    const attributes = [
      { name: "人間", className: "S01" },
      { name: "魚", className: "S02" },
      { name: "男性", className: "S03" },
      { name: "両棲類", className: "S04" },
      { name: "女性", className: "S05" },
      { name: "カエル", className: "S06" },
      { name: "巨人", className: "S07" },
      { name: "不死", className: "S08" },
      { name: "メカ", className: "S09" },
      { name: "骨", className: "S10" },
      { name: "岩石", className: "S11" },
      { name: "悪魔", className: "S12" },
      { name: "獣人", className: "S13" },
      { name: "火精", className: "S14" },
      { name: "獣", className: "S15"},
      { name: "水精", className: "S16" },
      { name: "竜", className: "S17" },
      { name: "風精", className: "S18" },
      { name: "爬虫類", className: "S19" },
      { name: "土精", className: "S20" },
      { name: "植物", className: "S21" },
      { name: "鳥", className: "S22" },
      { name: "虫", className: "S23" },
      { name: "浮遊", className: "S24" },
      { name: "水棲", className: "S25" },
      { name: "妖魔", className: "S26" }
    ];

    // 初期表示
    attributes.forEach(attr => {
      const div = document.createElement("div");
      div.className = "attribute";
      const id = `ステライヤリング_${attr.name}`;
      div.innerHTML = `<span class="${attr.className}">${attr.name}</span>&nbsp;<span class="stars" id="${id}">${decorateStars("☆☆☆☆☆")}</span>`;
      pierceGroup.appendChild(div);
    });

    function updateSummary() {
      let completeCount = 0;
      let totalStars = 0;
      let minOneCount = 0;
    
      const totalAttrs = attributes.length;
      const maxTotalStars = totalAttrs * 5;
    
      attributes.forEach(attr => {
        const el = document.getElementById(`ステライヤリング_${attr.name}`);
        const starText = el.textContent;
    
        if (starText.includes("★")) {
          minOneCount++;
        }
    
        if (starText === "★★★★★") {
          completeCount++;
        }
    
        const starNum = (starText.match(/★/g) || []).length;
        totalStars += starNum;
      });
    
      const compRate = ((completeCount / totalAttrs) * 100).toFixed(1);
      const minOneRate = ((minOneCount / totalAttrs) * 100).toFixed(1);
      const totalStarRate = ((totalStars / maxTotalStars) * 100).toFixed(1);
    
      document.getElementById("summary").innerHTML = `
        <div>トータル: ${totalStars} / ${maxTotalStars}</div>
        <div>最低１個: ${minOneCount} / ${totalAttrs}</div>
        <div>コンプ数: ${completeCount} / ${totalAttrs}</div>
      `;
    }

    // 星装飾
    function decorateStars(text){
      let result = "";
      for (let char of text) {
        result += char === "★" ? `<span style="color:gold;">★</span>` :
                  char === "☆" ? `<span style="color:gray;">☆</span>` : char;
      }
      return result;
    }

    // JSON読込
    document.getElementById("importJson").addEventListener("change", e => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const data = JSON.parse(e.target.result);
        for (let key in data) {
          const el = document.getElementById(key);
          if (el) el.innerHTML = decorateStars(data[key]);
        }
        updateSummary();
      };
      reader.readAsText(file);
    });

    // 初期表示の時点でも集計実行
    updateSummary();

    let zoomLevel = 1;

    // 拡大縮小の関数
    function changeZoom(delta) {
      zoomLevel += delta;
      if (zoomLevel < 0.5) zoomLevel = 0.5;  // 最小倍率0.5倍
      if (zoomLevel > 2.0) zoomLevel = 2.0;  // 最大倍率2倍
      document.body.style.zoom = zoomLevel;
    }

    // ページをリロードしたらサイドメニューを呼び出す
    window.onload = function () {
        loadSideMenu();
    }

  </script>

</body>
</html>